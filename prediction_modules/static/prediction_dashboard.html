<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜“ç¶“ç§‘å­¸é æ¸¬ç³»çµ± - ç¯‰æœªç§‘æŠ€</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <style>
        .hexagram-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .risk-high { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .risk-medium { background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); }
        .risk-low { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
        .pulse-animation {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app" class="min-h-screen">
        <!-- é ‚éƒ¨å°èˆª -->
        <nav class="bg-gradient-to-r from-purple-600 to-indigo-600 text-white shadow-lg">
            <div class="container mx-auto px-4 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <h1 class="text-2xl font-bold">ğŸ”® æ˜“ç¶“ç§‘å­¸é æ¸¬ç³»çµ±</h1>
                        <span class="text-sm opacity-75">çµåˆå‚³çµ±æ™ºæ…§èˆ‡ç¾ä»£ç§‘å­¸</span>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center space-x-2">
                            <div :class="wsConnected ? 'bg-green-400' : 'bg-red-400'" 
                                 class="w-3 h-3 rounded-full" 
                                 :class="{'pulse-animation': wsConnected}"></div>
                            <span class="text-sm">{{ wsConnected ? 'å³æ™‚é€£ç·š' : 'é›¢ç·š' }}</span>
                        </div>
                        <button @click="refreshData" 
                                class="bg-white text-purple-600 px-4 py-2 rounded-lg hover:bg-gray-100 transition">
                            ğŸ”„ é‡æ–°æ•´ç†
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- ä¸»è¦å…§å®¹ -->
        <div class="container mx-auto px-4 py-8">
            <!-- åˆ†é å°èˆª -->
            <div class="bg-white rounded-lg shadow-md mb-6">
                <div class="flex border-b">
                    <button v-for="tab in tabs" :key="tab.id"
                            @click="activeTab = tab.id"
                            :class="activeTab === tab.id ? 'border-b-2 border-purple-600 text-purple-600' : 'text-gray-600'"
                            class="px-6 py-4 font-medium hover:text-purple-600 transition">
                        {{ tab.icon }} {{ tab.name }}
                    </button>
                </div>
            </div>

            <!-- ç¸½è¦½åˆ†é  -->
            <div v-show="activeTab === 'overview'" class="space-y-6">
                <!-- ç§‘å­¸ç•°å¸¸æŒ‡æ¨™ -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-sm">é›»é›¢å±¤ç•°å¸¸</p>
                                <p class="text-3xl font-bold text-purple-600">{{ (anomalyData.ionosphere_anomaly * 100).toFixed(1) }}%</p>
                            </div>
                            <div class="text-4xl">âš¡</div>
                        </div>
                        <div class="mt-4 bg-gray-200 rounded-full h-2">
                            <div class="bg-purple-600 h-2 rounded-full" 
                                 :style="{width: (anomalyData.ionosphere_anomaly * 100) + '%'}"></div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow-md p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-sm">åœ°ç£ç•°å¸¸</p>
                                <p class="text-3xl font-bold text-indigo-600">{{ (anomalyData.geomagnetic_anomaly * 100).toFixed(1) }}%</p>
                            </div>
                            <div class="text-4xl">ğŸ§²</div>
                        </div>
                        <div class="mt-4 bg-gray-200 rounded-full h-2">
                            <div class="bg-indigo-600 h-2 rounded-full" 
                                 :style="{width: (anomalyData.geomagnetic_anomaly * 100) + '%'}"></div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow-md p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-sm">åœ°éœ‡æ´»å‹•åº¦</p>
                                <p class="text-3xl font-bold text-red-600">{{ (anomalyData.seismic_activity * 100).toFixed(1) }}%</p>
                            </div>
                            <div class="text-4xl">ğŸŒ</div>
                        </div>
                        <div class="mt-4 bg-gray-200 rounded-full h-2">
                            <div class="bg-red-600 h-2 rounded-full" 
                                 :style="{width: (anomalyData.seismic_activity * 100) + '%'}"></div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow-md p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-sm">æ°£å£“ç•°å¸¸</p>
                                <p class="text-3xl font-bold text-blue-600">{{ (anomalyData.pressure_anomaly * 100).toFixed(1) }}%</p>
                            </div>
                            <div class="text-4xl">ğŸŒ¡ï¸</div>
                        </div>
                        <div class="mt-4 bg-gray-200 rounded-full h-2">
                            <div class="bg-blue-600 h-2 rounded-full" 
                                 :style="{width: (anomalyData.pressure_anomaly * 100) + '%'}"></div>
                        </div>
                    </div>
                </div>

                <!-- æœ€æ–°é æ¸¬ -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div v-for="pred in latestPredictions" :key="pred.id"
                         class="bg-white rounded-lg shadow-md p-6 hover:shadow-xl transition">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-xl font-bold">{{ getPredictionTypeText(pred.prediction_type) }}</h3>
                            <span class="text-2xl">{{ getPredictionIcon(pred.prediction_type) }}</span>
                        </div>
                        
                        <div class="hexagram-card text-white rounded-lg p-4 mb-4">
                            <p class="text-sm opacity-75">å¦è±¡</p>
                            <p class="text-2xl font-bold">{{ pred.hexagram_name }}</p>
                            <p class="text-sm">ç¬¬ {{ pred.hexagram_number }} å¦</p>
                        </div>

                        <div class="space-y-2">
                            <div class="flex justify-between">
                                <span class="text-gray-600">é¢¨éšªç­‰ç´š</span>
                                <span class="font-bold" :class="getRiskColor(pred.risk_level)">
                                    {{ pred.risk_level.toFixed(1) }}%
                                </span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">é æ¸¬æ™‚é–“</span>
                                <span class="text-sm">{{ formatTime(pred.timestamp) }}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">é æ¸¬æœŸé–“</span>
                                <span class="text-sm">{{ pred.forecast_period }}</span>
                            </div>
                        </div>

                        <button @click="viewPredictionDetail(pred)" 
                                class="mt-4 w-full bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700 transition">
                            æŸ¥çœ‹è©³æƒ…
                        </button>
                    </div>
                </div>

                <!-- çµ±è¨ˆæ•¸æ“š -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-bold mb-4">ğŸ“Š é æ¸¬æº–ç¢ºåº¦çµ±è¨ˆ</h3>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div class="text-center p-4 bg-purple-50 rounded-lg">
                            <p class="text-gray-600 text-sm">ç¸½é æ¸¬æ¬¡æ•¸</p>
                            <p class="text-3xl font-bold text-purple-600">{{ statistics.total_predictions }}</p>
                        </div>
                        <div class="text-center p-4 bg-green-50 rounded-lg">
                            <p class="text-gray-600 text-sm">å·²é©—è­‰æ¬¡æ•¸</p>
                            <p class="text-3xl font-bold text-green-600">{{ statistics.verified_predictions }}</p>
                        </div>
                        <div class="text-center p-4 bg-blue-50 rounded-lg">
                            <p class="text-gray-600 text-sm">å¹³å‡æº–ç¢ºåº¦</p>
                            <p class="text-3xl font-bold text-blue-600">{{ statistics.average_accuracy }}%</p>
                        </div>
                        <div class="text-center p-4 bg-indigo-50 rounded-lg">
                            <p class="text-gray-600 text-sm">æˆåŠŸç‡</p>
                            <p class="text-3xl font-bold text-indigo-600">{{ statistics.success_rate }}%</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- åœ°éœ‡é æ¸¬åˆ†é  -->
            <div v-show="activeTab === 'earthquake'" class="space-y-6">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-2xl font-bold">ğŸŒ åœ°éœ‡é æ¸¬</h3>
                        <button @click="createPrediction('earthquake')" 
                                class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition">
                            ç«‹å³é æ¸¬
                        </button>
                    </div>

                    <div v-if="currentPrediction && currentPrediction.prediction_type === 'earthquake'"
                         class="border-2 border-purple-200 rounded-lg p-6 mb-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="text-lg font-bold mb-4">å¦è±¡è§£è®€</h4>
                                <div class="hexagram-card text-white rounded-lg p-6">
                                    <p class="text-3xl font-bold mb-2">{{ currentPrediction.hexagram_name }}</p>
                                    <p class="text-sm opacity-75 mb-4">{{ currentPrediction.prediction_details.trigrams }}</p>
                                    <p class="text-sm">{{ currentPrediction.prediction_details.hexagram_interpretation }}</p>
                                </div>
                            </div>

                            <div>
                                <h4 class="text-lg font-bold mb-4">é æ¸¬çµæœ</h4>
                                <div class="space-y-4">
                                    <div class="p-4 bg-red-50 rounded-lg">
                                        <p class="text-sm text-gray-600">é¢¨éšªç­‰ç´š</p>
                                        <p class="text-4xl font-bold text-red-600">{{ currentPrediction.risk_level.toFixed(1) }}%</p>
                                        <p class="text-sm text-gray-600 mt-2">{{ currentPrediction.prediction_details.risk_category }}</p>
                                    </div>

                                    <div class="p-4 bg-gray-50 rounded-lg">
                                        <p class="text-sm font-bold mb-2">é æ¸¬æŒ‡æ¨™ï¼š</p>
                                        <ul class="space-y-1">
                                            <li v-for="indicator in currentPrediction.prediction_details.indicators" 
                                                class="text-sm">â€¢ {{ indicator }}</li>
                                        </ul>
                                    </div>

                                    <div class="p-4 bg-yellow-50 rounded-lg">
                                        <p class="text-sm font-bold mb-2">å»ºè­°æªæ–½ï¼š</p>
                                        <p class="text-sm">{{ currentPrediction.prediction_details.recommendation }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- è¿‘æœŸåœ°éœ‡æ•¸æ“š -->
                    <div>
                        <h4 class="text-lg font-bold mb-4">ğŸ“ è¿‘æœŸåœ°éœ‡è¨˜éŒ„ï¼ˆ7å¤©å…§ï¼‰</h4>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-2 text-left">æ™‚é–“</th>
                                        <th class="px-4 py-2 text-left">ä½ç½®</th>
                                        <th class="px-4 py-2 text-left">è¦æ¨¡</th>
                                        <th class="px-4 py-2 text-left">æ·±åº¦</th>
                                        <th class="px-4 py-2 text-left">ä¾†æº</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="eq in earthquakeData" :key="eq.timestamp" 
                                        class="border-b hover:bg-gray-50">
                                        <td class="px-4 py-2 text-sm">{{ formatTime(eq.timestamp) }}</td>
                                        <td class="px-4 py-2 text-sm">{{ eq.location }}</td>
                                        <td class="px-4 py-2">
                                            <span :class="getMagnitudeColor(eq.magnitude)" 
                                                  class="font-bold">M {{ eq.magnitude.toFixed(1) }}</span>
                                        </td>
                                        <td class="px-4 py-2 text-sm">{{ eq.depth.toFixed(1) }} km</td>
                                        <td class="px-4 py-2 text-sm">{{ eq.source }}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ°£è±¡é æ¸¬åˆ†é  -->
            <div v-show="activeTab === 'weather'" class="space-y-6">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-2xl font-bold">ğŸŒ¤ï¸ æ°£è±¡é æ¸¬</h3>
                        <button @click="createPrediction('weather')" 
                                class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition">
                            ç«‹å³é æ¸¬
                        </button>
                    </div>

                    <div v-if="currentPrediction && currentPrediction.prediction_type === 'weather'"
                         class="border-2 border-blue-200 rounded-lg p-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="text-lg font-bold mb-4">å¦è±¡è§£è®€</h4>
                                <div class="hexagram-card text-white rounded-lg p-6">
                                    <p class="text-3xl font-bold mb-2">{{ currentPrediction.hexagram_name }}</p>
                                    <p class="text-sm">{{ currentPrediction.prediction_details.hexagram_interpretation }}</p>
                                </div>
                            </div>

                            <div>
                                <h4 class="text-lg font-bold mb-4">é æ¸¬çµæœ</h4>
                                <div class="space-y-4">
                                    <div class="p-4 bg-blue-50 rounded-lg">
                                        <p class="text-sm text-gray-600">å¤©æ°£é¡å‹</p>
                                        <p class="text-3xl font-bold text-blue-600">{{ currentPrediction.prediction_details.weather_type }}</p>
                                    </div>

                                    <div class="p-4 bg-orange-50 rounded-lg">
                                        <p class="text-sm text-gray-600">åš´é‡ç¨‹åº¦</p>
                                        <p class="text-3xl font-bold text-orange-600">{{ currentPrediction.risk_level.toFixed(1) }}%</p>
                                    </div>

                                    <div class="p-4 bg-gray-50 rounded-lg">
                                        <p class="text-sm font-bold mb-2">é æ¸¬æŒ‡æ¨™ï¼š</p>
                                        <ul class="space-y-1">
                                            <li v-for="indicator in currentPrediction.prediction_details.indicators" 
                                                class="text-sm">â€¢ {{ indicator }}</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç¶“æ¿Ÿé æ¸¬åˆ†é  -->
            <div v-show="activeTab === 'economy'" class="space-y-6">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-2xl font-bold">ğŸ“ˆ ç¶“æ¿Ÿé æ¸¬</h3>
                        <button @click="createPrediction('economy')" 
                                class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition">
                            ç«‹å³é æ¸¬
                        </button>
                    </div>

                    <div v-if="currentPrediction && currentPrediction.prediction_type === 'economy'"
                         class="border-2 border-green-200 rounded-lg p-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="text-lg font-bold mb-4">å¦è±¡è§£è®€</h4>
                                <div class="hexagram-card text-white rounded-lg p-6">
                                    <p class="text-3xl font-bold mb-2">{{ currentPrediction.hexagram_name }}</p>
                                    <p class="text-sm">{{ currentPrediction.prediction_details.hexagram_interpretation }}</p>
                                </div>
                            </div>

                            <div>
                                <h4 class="text-lg font-bold mb-4">é æ¸¬çµæœ</h4>
                                <div class="space-y-4">
                                    <div class="p-4 bg-green-50 rounded-lg">
                                        <p class="text-sm text-gray-600">å¸‚å ´è¶¨å‹¢</p>
                                        <p class="text-3xl font-bold text-green-600">{{ currentPrediction.prediction_details.trend }}</p>
                                    </div>

                                    <div class="p-4 bg-indigo-50 rounded-lg">
                                        <p class="text-sm text-gray-600">ä¿¡å¿ƒæŒ‡æ•¸</p>
                                        <p class="text-3xl font-bold text-indigo-600">{{ currentPrediction.risk_level.toFixed(1) }}%</p>
                                    </div>

                                    <div class="p-4 bg-gray-50 rounded-lg">
                                        <p class="text-sm font-bold mb-2">é æ¸¬æŒ‡æ¨™ï¼š</p>
                                        <ul class="space-y-1">
                                            <li v-for="indicator in currentPrediction.prediction_details.indicators" 
                                                class="text-sm">â€¢ {{ indicator }}</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ­·å²è¨˜éŒ„åˆ†é  -->
            <div v-show="activeTab === 'history'" class="space-y-6">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-2xl font-bold mb-6">ğŸ“œ é æ¸¬æ­·å²è¨˜éŒ„</h3>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-2 text-left">æ™‚é–“</th>
                                    <th class="px-4 py-2 text-left">é¡å‹</th>
                                    <th class="px-4 py-2 text-left">å¦è±¡</th>
                                    <th class="px-4 py-2 text-left">é¢¨éšªç­‰ç´š</th>
                                    <th class="px-4 py-2 text-left">ç‹€æ…‹</th>
                                    <th class="px-4 py-2 text-left">æº–ç¢ºåº¦</th>
                                    <th class="px-4 py-2 text-left">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="pred in historyPredictions" :key="pred.id" 
                                    class="border-b hover:bg-gray-50">
                                    <td class="px-4 py-2 text-sm">{{ formatTime(pred.timestamp) }}</td>
                                    <td class="px-4 py-2">
                                        <span class="px-2 py-1 bg-purple-100 text-purple-600 rounded text-sm">
                                            {{ getPredictionTypeText(pred.prediction_type) }}
                                        </span>
                                    </td>
                                    <td class="px-4 py-2 text-sm">{{ pred.hexagram_name }}</td>
                                    <td class="px-4 py-2">
                                        <span :class="getRiskColor(pred.risk_level)" class="font-bold">
                                            {{ pred.risk_level.toFixed(1) }}%
                                        </span>
                                    </td>
                                    <td class="px-4 py-2">
                                        <span :class="getStatusBadge(pred.status)" 
                                              class="px-2 py-1 rounded text-sm">
                                            {{ getStatusText(pred.status) }}
                                        </span>
                                    </td>
                                    <td class="px-4 py-2">
                                        <span v-if="pred.accuracy_score !== null" class="font-bold text-green-600">
                                            {{ pred.accuracy_score.toFixed(1) }}%
                                        </span>
                                        <span v-else class="text-gray-400">-</span>
                                    </td>
                                    <td class="px-4 py-2">
                                        <button @click="validatePrediction(pred)" 
                                                v-if="pred.status === 'pending'"
                                                class="text-blue-600 hover:text-blue-800 text-sm">
                                            é©—è­‰
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- é©—è­‰å°è©±æ¡† -->
        <div v-if="showValidationDialog" 
             class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                <h3 class="text-xl font-bold mb-4">é©—è­‰é æ¸¬çµæœ</h3>
                
                <div class="space-y-4">
                    <div v-if="validatingPrediction.prediction_type === 'earthquake'">
                        <label class="block text-sm font-medium mb-2">æ˜¯å¦ç™¼ç”Ÿåœ°éœ‡ï¼Ÿ</label>
                        <select v-model="validationData.occurred" class="w-full border rounded-lg px-3 py-2">
                            <option :value="true">æ˜¯</option>
                            <option :value="false">å¦</option>
                        </select>

                        <div v-if="validationData.occurred">
                            <label class="block text-sm font-medium mb-2 mt-4">åœ°éœ‡è¦æ¨¡</label>
                            <input v-model.number="validationData.magnitude" type="number" step="0.1"
                                   class="w-full border rounded-lg px-3 py-2">
                            
                            <label class="block text-sm font-medium mb-2 mt-4">è·é æ¸¬å¹¾å¤©å¾Œç™¼ç”Ÿ</label>
                            <input v-model.number="validationData.days_from_prediction" type="number"
                                   class="w-full border rounded-lg px-3 py-2">
                        </div>
                    </div>

                    <div v-if="validatingPrediction.prediction_type === 'weather'">
                        <label class="block text-sm font-medium mb-2">å¯¦éš›å¤©æ°£é¡å‹</label>
                        <select v-model="validationData.weather_type" class="w-full border rounded-lg px-3 py-2">
                            <option>æ­£å¸¸</option>
                            <option>é™é›¨</option>
                            <option>é«˜æº«</option>
                            <option>å¼·é¢¨</option>
                        </select>

                        <label class="block text-sm font-medium mb-2 mt-4">åš´é‡ç¨‹åº¦ (0-100)</label>
                        <input v-model.number="validationData.severity" type="number"
                               class="w-full border rounded-lg px-3 py-2">
                    </div>

                    <div v-if="validatingPrediction.prediction_type === 'economy'">
                        <label class="block text-sm font-medium mb-2">å¯¦éš›å¸‚å ´è¶¨å‹¢</label>
                        <select v-model="validationData.trend" class="w-full border rounded-lg px-3 py-2">
                            <option>ä¸Šå‡</option>
                            <option>ä¸‹é™</option>
                            <option>éœ‡ç›ª</option>
                            <option>æŒå¹³</option>
                        </select>

                        <label class="block text-sm font-medium mb-2 mt-4">å¯¦éš›æ³¢å‹•ç‡ (0-1)</label>
                        <input v-model.number="validationData.volatility" type="number" step="0.01"
                               class="w-full border rounded-lg px-3 py-2">
                    </div>
                </div>

                <div class="flex space-x-4 mt-6">
                    <button @click="submitValidation" 
                            class="flex-1 bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700">
                        æäº¤é©—è­‰
                    </button>
                    <button @click="showValidationDialog = false" 
                            class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400">
                        å–æ¶ˆ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    activeTab: 'overview',
                    tabs: [
                        { id: 'overview', name: 'ç¸½è¦½', icon: 'ğŸ“Š' },
                        { id: 'earthquake', name: 'åœ°éœ‡é æ¸¬', icon: 'ğŸŒ' },
                        { id: 'weather', name: 'æ°£è±¡é æ¸¬', icon: 'ğŸŒ¤ï¸' },
                        { id: 'economy', name: 'ç¶“æ¿Ÿé æ¸¬', icon: 'ğŸ“ˆ' },
                        { id: 'history', name: 'æ­·å²è¨˜éŒ„', icon: 'ğŸ“œ' }
                    ],
                    wsConnected: false,
                    ws: null,
                    anomalyData: {
                        ionosphere_anomaly: 0,
                        geomagnetic_anomaly: 0,
                        seismic_activity: 0,
                        pressure_anomaly: 0,
                        atmospheric_pressure: 1013
                    },
                    latestPredictions: [],
                    historyPredictions: [],
                    currentPrediction: null,
                    earthquakeData: [],
                    statistics: {
                        total_predictions: 0,
                        verified_predictions: 0,
                        average_accuracy: 0,
                        success_rate: 0
                    },
                    showValidationDialog: false,
                    validatingPrediction: null,
                    validationData: {}
                }
            },
            mounted() {
                this.initWebSocket();
                this.refreshData();
            },
            methods: {
                initWebSocket() {
                    const wsUrl = `ws://${window.location.hostname}:8025/ws/predictions`;
                    this.ws = new WebSocket(wsUrl);
                    
                    this.ws.onopen = () => {
                        this.wsConnected = true;
                        this.ws.send(JSON.stringify({ type: 'subscribe' }));
                    };
                    
                    this.ws.onmessage = (event) => {
                        const message = JSON.parse(event.data);
                        if (message.type === 'new_prediction') {
                            this.latestPredictions.unshift(message.data);
                            if (this.latestPredictions.length > 3) {
                                this.latestPredictions.pop();
                            }
                        }
                    };
                    
                    this.ws.onclose = () => {
                        this.wsConnected = false;
                        setTimeout(() => this.initWebSocket(), 5000);
                    };
                },
                async refreshData() {
                    await Promise.all([
                        this.fetchAnomalyData(),
                        this.fetchHistory(),
                        this.fetchStatistics(),
                        this.fetchEarthquakeData()
                    ]);
                },
                async fetchAnomalyData() {
                    try {
                        const response = await fetch('/api/scientific/anomaly');
                        this.anomalyData = await response.json();
                    } catch (error) {
                        console.error('ç²å–ç•°å¸¸æ•¸æ“šå¤±æ•—:', error);
                    }
                },
                async fetchHistory() {
                    try {
                        const response = await fetch('/api/prediction/history?limit=50');
                        const data = await response.json();
                        this.historyPredictions = data.predictions;
                        this.latestPredictions = data.predictions.slice(0, 3);
                    } catch (error) {
                        console.error('ç²å–æ­·å²è¨˜éŒ„å¤±æ•—:', error);
                    }
                },
                async fetchStatistics() {
                    try {
                        const response = await fetch('/api/prediction/statistics');
                        this.statistics = await response.json();
                    } catch (error) {
                        console.error('ç²å–çµ±è¨ˆæ•¸æ“šå¤±æ•—:', error);
                    }
                },
                async fetchEarthquakeData() {
                    try {
                        const response = await fetch('/api/scientific/earthquake?days=7');
                        const data = await response.json();
                        this.earthquakeData = data.data.slice(0, 20);
                    } catch (error) {
                        console.error('ç²å–åœ°éœ‡æ•¸æ“šå¤±æ•—:', error);
                    }
                },
                async createPrediction(type) {
                    try {
                        const response = await fetch('/api/prediction/predict', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                prediction_type: type,
                                use_time_casting: false
                            })
                        });
                        this.currentPrediction = await response.json();
                        await this.refreshData();
                    } catch (error) {
                        console.error('å‰µå»ºé æ¸¬å¤±æ•—:', error);
                        alert('é æ¸¬å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
                    }
                },
                validatePrediction(prediction) {
                    this.validatingPrediction = prediction;
                    this.validationData = {};
                    this.showValidationDialog = true;
                },
                async submitValidation() {
                    try {
                        const response = await fetch('/api/prediction/validate', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                prediction_id: this.validatingPrediction.id,
                                actual_event: this.validationData
                            })
                        });
                        const result = await response.json();
                        alert(`é©—è­‰å®Œæˆï¼æº–ç¢ºåº¦: ${result.accuracy_score.toFixed(1)}%`);
                        this.showValidationDialog = false;
                        await this.refreshData();
                    } catch (error) {
                        console.error('é©—è­‰å¤±æ•—:', error);
                        alert('é©—è­‰å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
                    }
                },
                viewPredictionDetail(prediction) {
                    this.currentPrediction = prediction;
                    this.activeTab = prediction.prediction_type;
                },
                getPredictionTypeText(type) {
                    const map = {
                        'earthquake': 'åœ°éœ‡',
                        'weather': 'æ°£è±¡',
                        'economy': 'ç¶“æ¿Ÿ'
                    };
                    return map[type] || type;
                },
                getPredictionIcon(type) {
                    const map = {
                        'earthquake': 'ğŸŒ',
                        'weather': 'ğŸŒ¤ï¸',
                        'economy': 'ğŸ“ˆ'
                    };
                    return map[type] || 'ğŸ“Š';
                },
                getRiskColor(risk) {
                    if (risk >= 70) return 'text-red-600';
                    if (risk >= 40) return 'text-orange-600';
                    return 'text-green-600';
                },
                getMagnitudeColor(mag) {
                    if (mag >= 6.0) return 'text-red-600';
                    if (mag >= 5.0) return 'text-orange-600';
                    if (mag >= 4.0) return 'text-yellow-600';
                    return 'text-green-600';
                },
                getStatusBadge(status) {
                    const map = {
                        'pending': 'bg-yellow-100 text-yellow-600',
                        'verified': 'bg-green-100 text-green-600',
                        'failed': 'bg-red-100 text-red-600'
                    };
                    return map[status] || 'bg-gray-100 text-gray-600';
                },
                getStatusText(status) {
                    const map = {
                        'pending': 'å¾…é©—è­‰',
                        'verified': 'å·²é©—è­‰',
                        'failed': 'å¤±æ•—'
                    };
                    return map[status] || status;
                },
                formatTime(timestamp) {
                    if (!timestamp) return '-';
                    const date = new Date(timestamp);
                    return date.toLocaleString('zh-TW');
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
