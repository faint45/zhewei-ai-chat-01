# 築未科技 — 全部上線、外網部屬、文件集中與保護

**用途**：讓四引擎全部上線、可選外網部屬、並將系統文件資料集中與保護。

---

## 一、全部上線（四引擎）

後台「引擎狀態」四項對應的環境變數與取得方式：

| 引擎 | 角色 | .env 變數 | 取得方式 |
|------|------|-----------|----------|
| **Gemini Admin** | 複雜決策/管理員 | `GEMINI_API_KEY` | https://aistudio.google.com/app/apikey |
| **Claude Dev** | 編碼/修正（階段 4、6） | `ANTHROPIC_API_KEY` 或 `CLAUDE_API_KEY` | https://console.anthropic.com/ |
| **Ollama Local** | 地端檢核（階段 4、5） | `OLLAMA_BASE_URL`（本機啟動 Ollama） | 本機安裝 Ollama，埠依你設定（如 11460） |
| **Media Gen** | Jimeng/Grok 影像 | `XAI_API_KEY` | https://x.ai/api |

### 操作步驟

1. **在專案根目錄的 `.env` 中補齊**（勿提交 .env 到 git）：
   - `GEMINI_API_KEY=` — 已有則略過。
   - `ANTHROPIC_API_KEY=` 或 `CLAUDE_API_KEY=` — 填其一，Claude Dev 即上線。
   - `OLLAMA_BASE_URL=http://localhost:11460` — 依你本機埠調整；Ollama 需先啟動。
   - `XAI_API_KEY=` — 填入後 Media Gen 上線。

2. **重啟完整跑**：關閉目前「啟動完整跑.bat」視窗（或結束佔用 8000 的行程），再雙擊 **啟動完整跑.bat**。重新整理後台即可看到四引擎狀態。

---

## 二、外網部屬（brain.zhe-wei.net）

**目的**：讓 https://brain.zhe-wei.net 從外網連到本機 brain_server。

### 步驟摘要

1. **Cloudflare Tunnel 完整 Token**  
   https://one.dash.cloudflare.com → Networks → Tunnels → 你的隧道 → **Reinstall connector** → 複製整段 Token（`eyJ...` 開頭），**不是**隧道 ID。

2. **.env 設定**  
   `CLOUDFLARE_TOKEN=` 改為上述**完整 Token**，存檔。

3. **重啟 Docker**  
   ```powershell
   cd c:\Users\user\Desktop\zhe-wei-tech
   docker compose down
   docker compose up -d
   ```

4. **確認**  
   `docker compose ps` 中 tunnel 為 **Up**；瀏覽器開 https://brain.zhe-wei.net/health 或 /admin。

詳細步驟與排查見 **剩下的如何處理.md** 第三節、**brain.zhe-wei.net_無法登入排查.md**。

---

## 三、文件資料集中與保護

### 3.1 資料位置一覽（集中對照）

| 類型 | 位置 | 說明 |
|------|------|------|
| **程式碼與設定** | `c:\Users\user\Desktop\zhe-wei-tech` | 專案根目錄；.env、腳本、文件 |
| **執行期工作區** | `D:\brain_workspace` | 靜態頁、input/processed/models、venv_vision、輸出 |
| **長期記憶/報表** | Z 槽（雲端 4.1TB） | Reports、長期記憶；依架構守則同步寫入 |
| **Open WebUI Compose** | `docker-compose.openwebui.yml` | Open WebUI + MCPO 容器定義；Open WebUI 對外 `3000` |
| **MCP 工具設定** | `mcpo\config.json` | filesystem/puppeteer/memory 三個 MCP server 定義 |
| **Open WebUI 啟動腳本** | `Start_OpenWebUI.bat` | 一鍵啟動 Open WebUI 與 MCPO 容器 |
| **Open WebUI 資料卷** | Docker volume `zhe-wei-tech_open-webui-data` | Open WebUI 本機資料庫、設定與使用者資料 |
| **MCPO 對外埠（本機）** | `http://localhost:18010` | Windows 保留 `8010` 連接埠，改用 `18010`；容器內仍是 `mcpo:8000` |
| **敏感資訊** | `.env`（專案根目錄） | API Key、Token；**不可提交 git** |
| **版控** | GitHub `faint45/zhewei-ai-chat-01` | 程式碼與文件；.env 已在 .gitignore |

### 3.2 保護措施

1. **.env 不提交**  
   - 確認 `.gitignore` 含 `.env`。  
   - 勿將 `.env` 加入 git；複製專案時手動從 `.env.example` 複製並填值。

2. **重要文件集中**  
   - **操作與交接**：專案根目錄 `*說明*.md`、`*如何處理*.md`、`*引導*.md`、`交接清單*.md` 等已集中於根目錄。  
   - **部署與狀態**：`剩下的如何處理.md`、`目前狀態.md`、`下一步勾選清單.md`、`全部上線_外網部屬_文件保護.md`（本檔）集中於根目錄。  
   - 可另建 `docs/` 子目錄做歸檔，再將上述 md 以複製或連結方式集中（不強制移動以免影響既有腳本路徑）。

3. **備份建議**  
   - **Z 槽**：雲端冷資料；依既有流程同步報表與長期記憶。  
   - **D 槽**：`D:\brain_workspace` 可定期複製至外接碟或另一磁碟。  
   - **專案與 .env**：專案目錄可壓縮備份；.env 單獨備份至加密或安全位置，勿放公開儲存。

4. **權限與存取**  
   - 本機：僅授權人員可存取專案目錄與 D 槽。  
   - 外網：依 Cloudflare Zero Trust 與隧道設定；必要時限制 IP 或登入。

### 3.3 快速檢查清單

- [ ] `.env` 已從 `.env.example` 複製並填寫，且未提交 git。  
- [ ] 重要說明與交接文件集中在專案根目錄（或自訂 `docs/`）。  
- [ ] Z 槽報表/長期記憶依架構正常寫入。  
- [ ] D 槽 `brain_workspace` 有備份或同步策略。  
- [ ] 外網 brain.zhe-wei.net 僅授權對象可存取（若已部屬）。

---

## 四、對照總表

| 目標 | 主要動作 |
|------|----------|
| **全部上線** | .env 填齊 `GEMINI_API_KEY`、`ANTHROPIC_API_KEY` 或 `CLAUDE_API_KEY`、`OLLAMA_BASE_URL`、`XAI_API_KEY`；重啟「啟動完整跑.bat」。 |
| **外網部屬** | .env 填完整 `CLOUDFLARE_TOKEN`；`docker compose down` 再 `docker compose up -d`。 |
| **文件集中與保護** | 依 3.1 對照位置；.env 不提交、重要 md 集中於根目錄或 docs/、Z/D 與 .env 備份與權限依 3.2。 |
