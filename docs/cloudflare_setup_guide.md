# ğŸŒ Cloudflare Zero Trust ä¸»åŸŸåé…ç½®æŒ‡å—

## ğŸ“‹ é…ç½®æ¸…å–®

éœ€è¦åœ¨ Cloudflare Zero Trust æ·»åŠ ä»¥ä¸‹åŸŸåï¼š

| åŸŸå | æœå‹™ | å„ªå…ˆç´š |
|------|------|--------|
| **zhe-wei.net** | Portal PWA | ğŸ”´ å¿…é ˆ |
| **www.zhe-wei.net** | Portal PWA | ğŸ”´ å¿…é ˆ |

## ğŸš€ æ“ä½œæ­¥é©Ÿ

### æ­¥é©Ÿ 1ï¼šç™»å…¥ Cloudflare Zero Trust

1. è¨ªå•ï¼šhttps://one.dash.cloudflare.com/
2. é¸æ“‡ä½ çš„å¸³è™Ÿ
3. é€²å…¥ **Access** â†’ **Tunnels**

### æ­¥é©Ÿ 2ï¼šé¸æ“‡ç¾æœ‰ Tunnel

1. æ‰¾åˆ°ä½ çš„ Tunnelï¼ˆæ‡‰è©²å·²ç¶“æœ‰ bridge.zhe-wei.net ç­‰åŸŸåï¼‰
2. é»æ“Š Tunnel åç¨±
3. é»æ“Š **Configure** æŒ‰éˆ•
4. åˆ‡æ›åˆ° **Public Hostname** æ¨™ç±¤

### æ­¥é©Ÿ 3ï¼šæ·»åŠ ä¸»åŸŸå (zhe-wei.net)

é»æ“Š **"Add a public hostname"** æŒ‰éˆ•ï¼Œå¡«å¯«ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Public hostname                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Subdomain: [ç•™ç©º]                       â”‚
â”‚ Domain: zhe-wei.net                     â”‚
â”‚ Path: [ç•™ç©º]                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Service                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Type: HTTP                              â”‚
â”‚ URL: gateway:80                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Additional application settings         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [å¯é¸] TLS è¨­å®šã€HTTP è¨­å®šç­‰            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é‡è¦**ï¼š
- Subdomain æ¬„ä½**ç•™ç©º**ï¼ˆé€™æ˜¯ä¸»åŸŸåï¼‰
- Service URL ä½¿ç”¨ `gateway:80`ï¼ˆä¸æ˜¯ localhost:8888ï¼‰

é»æ“Š **Save hostname**

### æ­¥é©Ÿ 4ï¼šæ·»åŠ  WWW å­åŸŸå (www.zhe-wei.net)

å†æ¬¡é»æ“Š **"Add a public hostname"**ï¼Œå¡«å¯«ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Public hostname                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Subdomain: www                          â”‚
â”‚ Domain: zhe-wei.net                     â”‚
â”‚ Path: [ç•™ç©º]                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Service                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Type: HTTP                              â”‚
â”‚ URL: gateway:80                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

é»æ“Š **Save hostname**

## âœ… é©—è­‰é…ç½®

### 1. æª¢æŸ¥ Cloudflare æ§åˆ¶å°

åœ¨ Public Hostname åˆ—è¡¨ä¸­æ‡‰è©²çœ‹åˆ°ï¼š

```
âœ… zhe-wei.net â†’ gateway:80
âœ… www.zhe-wei.net â†’ gateway:80
âœ… bridge.zhe-wei.net â†’ gateway:80
âœ… jarvis.zhe-wei.net â†’ gateway:80
... (å…¶ä»–å·²é…ç½®çš„åŸŸå)
```

### 2. ç­‰å¾… DNS ç”Ÿæ•ˆ

é€šå¸¸éœ€è¦ **10-30 ç§’**ï¼ŒCloudflare æœƒè‡ªå‹•ï¼š
- å‰µå»º DNS CNAME è¨˜éŒ„
- é…ç½® SSL/TLS è­‰æ›¸
- æ›´æ–° Tunnel é…ç½®

### 3. æ¸¬è©¦è¨ªå•

```bash
# æ¸¬è©¦ä¸»åŸŸå
curl -I https://zhe-wei.net

# æ¸¬è©¦ WWW å­åŸŸå
curl -I https://www.zhe-wei.net

# æ‡‰è©²è¿”å› 200 OK
```

### 4. ç€è¦½å™¨æ¸¬è©¦

è¨ªå•ä»¥ä¸‹ç¶²å€ï¼š
- https://zhe-wei.net
- https://www.zhe-wei.net

æ‡‰è©²çœ‹åˆ° **Portal PWA** å…¥å£ç¶²ç«™ï¼Œé¡¯ç¤ºæ‰€æœ‰æœå‹™å¡ç‰‡ã€‚

## ğŸ¯ å®Œæ•´åŸŸåæ¶æ§‹

é…ç½®å®Œæˆå¾Œçš„åŸŸåçµæ§‹ï¼š

```
zhe-wei.net (ä¸»åŸŸå)
â”œâ”€â”€ www.zhe-wei.net          â†’ Portal PWA å…¥å£
â”œâ”€â”€ jarvis.zhe-wei.net       â†’ Jarvis AI å¤§è…¦
â”œâ”€â”€ bridge.zhe-wei.net       â†’ Smart Bridge å°è©±æ©‹æ¥
â”œâ”€â”€ dify.zhe-wei.net         â†’ Dify AI å·¥ä½œæµ
â”œâ”€â”€ cms.zhe-wei.net          â†’ ç‡Ÿå»ºç®¡ç†ç³»çµ±
â”œâ”€â”€ vision.zhe-wei.net       â†’ AI è¦–è¦ºè¾¨è­˜
â”œâ”€â”€ codesim.zhe-wei.net      â†’ ä»£ç¢¼æ¨¡æ“¬å™¨
â””â”€â”€ ufocam.zhe-wei.net       â†’ UFO ç›£æ§ç³»çµ±
```

## ğŸ”§ æ•…éšœæ’é™¤

### âŒ å•é¡Œï¼š404 Not Found

**åŸå› **ï¼šGateway æœªé…ç½®è©²åŸŸåè·¯ç”±

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
```bash
# æª¢æŸ¥ Gateway é…ç½®
docker compose exec gateway cat /etc/nginx/nginx.conf | grep "server_name.*zhe-wei.net"

# æ‡‰è©²çœ‹åˆ°ï¼š
# server_name zhe-wei.net www.zhe-wei.net;

# å¦‚æœæ²’æœ‰ï¼Œé‡å•Ÿ Gateway
docker compose restart gateway
```

### âŒ å•é¡Œï¼š502 Bad Gateway

**åŸå› **ï¼šPortal æœå‹™æœªé‹è¡Œ

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
```bash
# æª¢æŸ¥ Portal ç‹€æ…‹
curl http://localhost:8888/health

# å¦‚æœå¤±æ•—ï¼Œå•Ÿå‹• Portal
python portal_server.py

# æˆ–ä½¿ç”¨ Docker
docker compose up -d portal
```

### âŒ å•é¡Œï¼šDNS è§£æå¤±æ•—

**åŸå› **ï¼šDNS è¨˜éŒ„æœªè‡ªå‹•å‰µå»º

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. é€²å…¥ Cloudflare Dashboard
2. é¸æ“‡ **zhe-wei.net** åŸŸå
3. é»æ“Š **DNS** æ¨™ç±¤
4. æª¢æŸ¥æ˜¯å¦æœ‰ä»¥ä¸‹è¨˜éŒ„ï¼š
   ```
   Type: CNAME
   Name: @
   Content: <tunnel-id>.cfargotunnel.com
   Proxy: âœ… Proxied
   
   Type: CNAME
   Name: www
   Content: <tunnel-id>.cfargotunnel.com
   Proxy: âœ… Proxied
   ```

### âŒ å•é¡Œï¼šWebSocket é€£æ¥å¤±æ•—

**åŸå› **ï¼šCloudflare éœ€è¦å•Ÿç”¨ WebSocket

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. åœ¨ Cloudflare Dashboard
2. é¸æ“‡ **zhe-wei.net** åŸŸå
3. **Network** æ¨™ç±¤
4. ç¢ºèª **WebSockets** å·²å•Ÿç”¨

## ğŸ“± PWA åŠŸèƒ½æ¸¬è©¦

é…ç½®å®Œæˆå¾Œï¼Œæ¸¬è©¦ä»¥ä¸‹ PWA åŠŸèƒ½ï¼š

### 1. å®‰è£æç¤º
- è¨ªå• https://zhe-wei.net
- æ‡‰è©²çœ‹åˆ°åº•éƒ¨å½ˆå‡ºå®‰è£æç¤º
- æˆ–åœ°å€æ¬„å³å´æœ‰å®‰è£åœ–æ¨™

### 2. Service Worker
- é–‹å•Ÿ DevTools (F12)
- Application â†’ Service Workers
- æ‡‰è©²çœ‹åˆ° `sw.js` å·²è¨»å†Šä¸¦é‹è¡Œ

### 3. WebSocket å°è©±
- é»æ“Šå³ä¸‹è§’èŠå¤©åœ–æ¨™
- å°è©±é¢æ¿æ‡‰è©²å½ˆå‡º
- è¼¸å…¥ "ç‹€æ…‹" æ¸¬è©¦é€£æ¥

### 4. é›¢ç·šæ¨¡å¼
- DevTools â†’ Network â†’ Offline
- é‡æ–°æ•´ç†é é¢
- æ‡‰è©²ä»èƒ½çœ‹åˆ°å¿«å–çš„å…§å®¹

## ğŸ‰ å®Œæˆï¼

é…ç½®å®Œæˆå¾Œï¼Œä½ å¯ä»¥ï¼š

âœ… å¾ä»»ä½•è¨­å‚™è¨ªå• https://zhe-wei.net  
âœ… å®‰è£ PWA åˆ°æ¡Œé¢/ä¸»ç•«é¢  
âœ… ä½¿ç”¨å³æ™‚å°è©±åŠŸèƒ½  
âœ… é ç«¯æˆæ¬Š AI æ“ä½œ  
âœ… é›¢ç·šè¨ªå•å¿«å–å…§å®¹  
âœ… çµ±ä¸€å“ç‰ŒåŸŸåç®¡ç†æ‰€æœ‰æœå‹™  

---

## ğŸ“ éœ€è¦å¹«åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°å•é¡Œï¼š
1. æª¢æŸ¥ Tunnel æ—¥èªŒï¼š`docker compose logs -f tunnel`
2. æª¢æŸ¥ Gateway æ—¥èªŒï¼š`docker compose logs -f gateway`
3. æª¢æŸ¥ Portal æ—¥èªŒï¼š`docker compose logs -f portal`
4. åƒè€ƒå®Œæ•´æ–‡æª”ï¼š`docs/pwa_deployment.md`
