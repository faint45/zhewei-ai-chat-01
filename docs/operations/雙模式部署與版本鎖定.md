# 雙模式部署與版本鎖定（2026-02）

## 1) 模式切換

- 日常模式（最小資源）  
  `powershell -ExecutionPolicy Bypass -File scripts/switch_stack_mode.ps1 -Mode daily`

- 開發模式（全功能）  
  `powershell -ExecutionPolicy Bypass -File scripts/switch_stack_mode.ps1 -Mode dev`

- compose profile 直接操作  
  - 日常：`docker compose -f docker-compose.profiles.yml --profile daily up -d`
  - 開發：`docker compose -f docker-compose.profiles.yml --profile daily --profile dev up -d`

## 2) 版本鎖定

- 主環境鎖檔：`requirements.lock`
- MetaGPT 鎖檔：`requirements-metagpt.lock`

更新方式：

```powershell
& "Jarvis_Training\.venv312\Scripts\python.exe" -m pip freeze | Sort-Object | Set-Content -Encoding UTF8 requirements.lock
& "MetaGPT_env\.venv\Scripts\python.exe" -m pip freeze | Sort-Object | Set-Content -Encoding UTF8 requirements-metagpt.lock
```

## 3) 觀測告警

- 啟動監控：`scripts\start_runtime_monitor.bat`
- 監控腳本：`scripts\monitor_runtime_and_notify.py`
- 監控來源：
  - `Jarvis_Training/discord_bot_runtime.log`
  - `brain_system.log`
  - `docker ps -a` 狀態（exited/unhealthy/restarting）

## 4) 健康儀表板

- 儀表板 URL：`/health-dashboard`
- API：`/api/health/summary`
- 含核心、語音、外部依賴（Qdrant/Redis/Postgres/Weaviate/n8n）
