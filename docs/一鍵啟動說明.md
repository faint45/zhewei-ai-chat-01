# 築未科技大腦 — 一鍵啟動說明

## 快速啟動

```
雙擊 一鍵啟動.bat
```

或命令列：

```batch
cd D:\zhe-wei-tech
一鍵啟動.bat
```

---

## 啟動流程（6 步驟）

| 步驟 | 項目 | 說明 |
|------|------|------|
| 1 | 依賴鎖定 | `pip install -r requirements.lock` + `requirements-voice.txt`（戰術語音、Graph RAG） |
| 2 | 環境變數 | 檢查 `.env`，不存在則由 `.env.example` 建立；`ensure_env_ollama.py` 補齊 OLLAMA 設定 |
| 3 | Docker 容器 | 啟動 `zhewei_brain`、`zhe-wei-ollama`、`zhewei-qdrant`、`tunnel` |
| 4 | Ollama 模型 | 拉取 `qwen2.5-coder:7b`、`deepseek-r1:8b` |
| 5 | Monitor + Bot | 啟動 `monitor_runtime_and_notify.py`、Discord Bot |
| 6 | 完成 | 開啟瀏覽器至 http://127.0.0.1:8002 |

---

## 專案功能整理

### 核心服務

| 服務 | 埠 | 說明 |
|------|-----|------|
| Brain Server | 8002 | 大腦 API、Agent Hub、WebSocket |
| Health Dashboard | 8002/health-dashboard | 健康檢查 |
| Agent Hub | 8002/agent-hub | 代理任務、Chat、戰術語音、Graph RAG |

### 擴充模組

| 模組 | 說明 | 依賴 |
|------|------|------|
| 戰術語音 | `!voice join` / `!talk <文字>` 或附加音檔 | openai-whisper, edge-tts |
| Graph RAG | PDF→圖→VLM 描述→向量庫；`search_graph_rag` | pdf2image, PyMuPDF |
| Task Butler | 全通訊收件→分類→低風險自動派工 | - |
| 命令白名單 | `configs/host_command_policy.json`、`task_butler_risk_policy.json` | - |

### 關鍵檔案

| 用途 | 路徑 |
|------|------|
| 一鍵啟動 | `一鍵啟動.bat` |
| 完整部署 | `Deploy_All.bat` |
| 穩定啟動 | `Start_All_Stable.bat` |
| 監控 | `scripts/start_runtime_monitor.bat` |
| Discord Bot | `Jarvis_Training/run_discord_bot_autostart.bat` |
| 戰術語音 | `Jarvis_Training/jarvis_voice_commander.py` |
| Graph RAG | `brain_modules/brain_graph_rag.py` |
| 白名單 | `configs/task_butler_risk_policy.json` |

---

## 前置需求

- **Docker Desktop**：需已安裝並啟動（若未安裝，流程會跳過容器步驟）
- **Python 3.12**：`Jarvis_Training/.venv312` 需存在
- **.env**：至少設定 `DISCORD_BOT_TOKEN`、`GEMINI_API_KEY`（可選）

---

## 疑難排解

| 問題 | 對策 |
|------|------|
| Docker 未就緒 | 確認 Docker Desktop 已啟動，等待約 30 秒後重試 |
| Brain 無法連線 | 檢查 `docker ps` 是否有 `zhewei_brain`；埠 8002 是否被佔用 |
| Discord Bot 無回應 | 檢查 `.env` 的 `DISCORD_BOT_TOKEN`；Bot 是否已加入伺服器 |
| 戰術語音失敗 | 執行 `pip install -r requirements-voice.txt`；確認 Brain API 可達 `http://127.0.0.1:8002` |
| 八階段流程錯誤 | 檢查 `agent_tools.py` 無語法錯誤；重啟 monitor 與 bot |
