# 築未科技 — 需求到完成八階段流程

**目的**：從網頁管理員接收指令到完成佈署、報表歸檔與後台更新的完整八階段定義。

---

## 八階段總覽

| 階段 | 名稱 | 負責組件 | 說明 |
|------|------|----------|------|
| **1** | 需求 (Requirement) | 網頁管理員 | 接收指令 |
| **2** | 整合理解 (Understanding) | 管理員 (Gemini) | 從 Z 槽提取記憶，理解任務複雜度 |
| **3** | 安排 (Arrangement) | 大腦 (Manager) | 產出計畫；涉及影像則調度 Grok，涉及程式則調度 Claude |
| **4** | 執行 (Execution) | Claude / Jimeng / Ollama | 編碼、媒體、本地資料清洗 |
| **5** | 確認 (Confirmation I) | 本地代理人 (Ollama) | 基礎合規檢核 |
| **6** | 回饋修正 (Feedback & Fix) | Claude 3.5 + Cursor Pro | 錯誤碼精準修復，最終代碼調校 |
| **7** | 確認 (Confirmation II) | 管理員 (Gemini) | 多模型交叉驗證，確保邏輯 $100\%$ 正確 |
| **8** | 完成與佈署 (Completion) | 大腦 | 觸發佈署指令、LaTeX 報表至 Z 槽、更新網頁後台 |

---

## 1. 需求 (Requirement)

- **網頁管理員** 接收指令。
- **對應**：brain_server WebSocket（`/ws`）接收 `{"text":"..."}` 或 `{"message":"..."}`；未來可擴充為網頁後台表單或 API 下單，再轉發至 brain_server。

---

## 2. 整合理解 (Understanding)

- **管理員 (Gemini)** 從 Z 槽提取記憶，理解任務複雜度。
- **對應**：AgentManager `_load_long_term_memory()` 從 **Z:/Zhewei_Brain/Rules/master_rules.md** 載入核心守則；`_classify_task()` 判斷 vision / complex / conversation，決定後續調度。

---

## 3. 安排 (Arrangement)

- **大腦 (Manager)** 產出計畫；若涉及**影像**則調度 **Grok**，涉及**程式**則調度 **Claude**。
- **對應**：agent_logic 引擎分流 — 視覺任務強制 **Gemini**（或接線後改為 Grok）；複雜/程式任務可注入 **Claude**（`claude_service`）。目前影像鏈為 YOLOv8 + vision_worker，Grok 可作為雲端影像擴充。

---

## 4. 執行 (Execution)

| 類型 | 負責 | 說明 |
|------|------|------|
| **編碼** | Claude | 寫出代碼；**Windsurf** 實體建立 D:/brain_workspace 下專案 |
| **媒體** | Jimeng | 產出工程 3D 模擬圖或影片 |
| **本地** | Ollama | 處理 D 槽大批資料清洗 |

- **對應**：TOOLS（run_command、write_file、read_file、list_dir）經 AgentManager 執行；產出落地 **D:\brain_workspace**（路徑限 D/Z）。Claude 經 ReAct 決策寫入代碼；Ollama 負責簡單清洗與檢索。Jimeng 為媒體產出擴充點，可接 API 或獨立服務。

---

## 5. 確認 (Confirmation I)

- **本地代理人 (Ollama)** 進行基礎合規檢核。
- **對應**：ReAct 循環中 Observation 回傳後，若為錯誤或 stderr 則觸發修復；可選「檢核」工具或由 Ollama 再跑一輪檢核指令，產出校對 Log（D 槽或 Z 槽）。

---

## 6. 回饋修正 (Feedback & Fix)

- **Claude 3.5** 針對錯誤碼進行精準修復；**Cursor Pro** 進行最終代碼調校。
- **對應**：agent_logic 在 Observation 異常時切換 **Gemini**（或 Claude）；修復結果經 TOOLS 寫入 D 槽。人工或 Cursor Pro 對 D:\brain_workspace 下產出進行 Composer 微調。

---

## 7. 確認 (Confirmation II)

- **管理員 (Gemini)** 進行多模型交叉驗證，確保邏輯 **$100\%$** 正確。
- **對應**：AgentManager `_cross_validate_results(raw_vision_data)` — Gemini 深度分析 → 第二意見（Claude／元寶／千問）檢核 → `_is_logical_gap()` 判定；一致則定稿，分歧則標註「待確認」並回傳 Gemini Pro 裁決。進度以 LaTeX 呈現。

---

## 8. 完成與佈署 (Completion)

- **大腦** 觸發佈署指令（如：啟動服務）；產出 **LaTeX 報表**至 **Z 槽**；並更新**網頁後台**畫面。
- **對應**：
  - **佈署**：可經 run_command 觸發腳本（如 start_all.ps1、安裝服務）或呼叫佈署 API；路徑限 D/Z。
  - **報表**：report_generator 寫入 Z:/Zhewei_Brain/Reports/（JSONL、CSV、Daily_Voice_Logs.md），進度欄位為 **$X\%$**。
  - **網頁後台**：前端輪詢或 WebSocket 訂閱 brain_server 狀態；後台畫面更新為擴充點（API 或靜態頁重新載入）。

---

## 與既有文件對照

| 文件 | 對應內容 |
|------|----------|
| **各項工作流完成說明.md** | 編碼、撰寫、運算、分配、執行、回饋、生成 — 由誰完成、用何工具、產出何處 |
| **可以符合的Win_MCP清單.md** | 八階段與 MCP 實體動作合併對照（六、與八階段工作流合併對照） |
| **系統運作方式彙整.md** | 核心組件、請求流程、鎖定規則 |
| **通用執行引擎架構表.md** | Draft / Fix / Done、階段 1–8 路徑約定 |
| **雲地分流與多模型確認.md** | 雲地分流、實體開發同步、Step 7 異構檢核 |
| **影像到報表端到端流程.md** | 影像輸入 → 視覺辨識 → 邏輯編排 → 修復 → 檢核 → 存檔 |

---

*實際實作請遵守架構守則與全系統架構鎖定規則；Grok、Jimeng、網頁後台為擴充點，可依接線狀況對齊。*
