# 築未科技 — 雲地分流與多模型確認

**目的**：成本優化、實體開發同步、產出前多模型交叉確認。

---

## 一、雲地分流（成本優化）

### 地端勞力（Ollama / Qwen 2.5）

- **執行環境**：RTX 4060 Ti 本地運算，完全免費且保護隱私。
- **負責**：
  - 初稿閱讀
  - 簡單格式轉換
  - 基礎代碼檢索

### 雲端大腦（Claude / Gemini）

- **啟動時機**：僅在需要下列情境時才啟動，最大化加值服務價值。
  - 高難度邏輯推理
  - 長文本合約分析
  - 複雜影像辨識

### 對應現有實作

- **agent_logic.py**：`_classify_task()` → vision / complex 強制 **Gemini**；conversation 預設 **Ollama**；Observation 嚴重錯誤時切換 **Gemini**。
- **ai_service.py**：GeminiService（雲端）、OllamaService（地端 Qwen 2.5），介面 `chat(messages)`。

---

## 二、實體開發同步（Cursor / Windsurf）

- **產出落地**：`agent_logic.py` 經 TOOLS 產出的檔案直接落地在 **D:\brain_workspace**（或專案內 `brain_workspace`）；路徑限 D 槽與 Z 槽（`_path_allowed`）。
- **索引與編輯**：開啟 **Cursor Pro** 或 **Windsurf** 時，會自動索引 D 槽上由 AI 產出的 Draft。
- **工作流**：可在 Cursor 的 **Composer** 模式中，直接對這些檔案下達指令，例如：「根據階段 6 的修正建議進行重構」。

### 路徑對齊

- 若採用通用執行引擎的 Draft / Fix / Done，可對應：
  - Draft、Fix → `D:\brain_workspace\` 下任務子目錄或 `D:\Project\{任務}\Draft`、`Fix`
  - Done → 通過門檻後搬至 Z 槽或 `D:\Project\{任務}\Done`

---

## 三、多模型交叉確認（Step 7）

在產出正式報表前，系統可將結果同時發送給：

- **元寶（騰訊）** 或 **千問（阿里）**
- 與主線模型（如 Claude / Gemini）的產出進行比對

### 判定規則

| 情況 | 判定 | 動作 |
|------|------|------|
| 元寶／千問檢核結果與主線（Claude/Gemini）**一致** | **$100\%$ 正確** | 通過門檻，觸發存檔／歸檔 |
| **有分歧** | **待確認** | 標註後回傳給 **Gemini Pro** 進行最後裁決 |

### 進度呈現

- 進度數值以 **LaTeX 格式** 呈現，例如：`$100\%$`。

### 實作備註

- 元寶、千問需對接各自 API（騰訊、阿里）；目前 ai_service 已預留 AliyunService（千問）、TencentService（混元），尚未接線。
- Step 7 多模型交叉確認可作為後續擴充：在 report_generator 或 agent_logic 完成主線產出後，呼叫第二、第三模型做檢核，再依一致／分歧執行通過或「待確認 → Gemini Pro 裁決」。

---

## 四、與系統彙整對照

| 項目 | 對應文件／組件 |
|------|----------------|
| 雲地分流 | agent_logic 引擎分流、ai_service Gemini/Ollama |
| 產出落地 D 槽 | agent_tools 路徑限制、D:\brain_workspace、通用執行引擎架構表 |
| 多模型 Step 7 | 待擴充：ai_service 預留 Aliyun/Tencent；裁決邏輯可落於 agent_logic 或報表前處理 |

**端到端六步**（影像輸入 → 視覺辨識 → 邏輯編排 → 代碼修復 → 異構檢核 → 自動化存檔）見 **[影像到報表端到端流程.md](影像到報表端到端流程.md)**。

---

*實際實作時請遵守架構守則與全系統架構鎖定規則（D/Z 分流、報表路徑、LaTeX 進度）。*
