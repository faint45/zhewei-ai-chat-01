# 當機修復與優化指南

針對 **NVIDIA 顯示驅動／顯示容器** 導致的藍屏（BugCheck 0x119）與 NVDisplay.Container 崩潰，以下為修復與優化步驟。

---

## 一、快速修復（先做）

### 1. 執行穩定性腳本（需管理員權限）

在專案目錄下以**系統管理員**身分開啟 PowerShell，執行：

```powershell
cd "C:\Users\user\Desktop\zhe-wei-tech\scripts"
.\repair_nvidia_stability.ps1
```

腳本會：

- 匯出近期 NVIDIA/顯示相關錯誤事件到 `logs\nvidia_errors_*.csv`
- 重啟 NVIDIA 顯示容器與相關服務（暫時緩解崩潰）
- 檢查電源計畫並可切換為「高效能」
- 確認小記憶體傾印設定
- 顯示目前驅動版本與建議下一步

### 2. 更新 NVIDIA 驅動（根本修復）

1. 前往 [NVIDIA 驅動程式下載](https://www.nvidia.com/Download/index.aspx)
2. 選擇：**GeForce RTX 4060 Ti**、您的 Windows 版本
3. 下載最新 **Game Ready** 或 **Studio** 驅動
4. 安裝時選擇 **「自訂安裝」** → 勾選 **「執行全新安裝」**
5. 安裝完成後重新開機

若更新後仍當機，請進行「徹底重裝驅動」（下一節）。

---

## 二、徹底重裝驅動（仍當機時）

1. 下載 **DDU (Display Driver Uninstaller)**：  
   [https://www.guru3d.com/files-details/display-driver-uninstaller-download.html](https://www.guru3d.com/files-details/display-driver-uninstaller-download.html)
2. 從 NVIDIA 官網下載 **最新驅動**（先不要安裝）
3. 進入 **安全模式**（設定 → 系統 → 復原 → 進階啟動 → 疑難排解 → 進階選項 → 啟動設定 → 重新啟動 → 按 4 選「安全模式」）
4. 在安全模式下執行 DDU，選擇 **「清除並重新啟動」**（NVIDIA）
5. 重開機回到正常模式後，安裝剛才下載的驅動，勾選「執行全新安裝」
6. 安裝完成後再重開機一次

---

## 三、優化項目（降低再次當機機率）

### 3.1 關閉 GeForce Experience 非必要功能

- 開啟 **GeForce Experience** → 設定
- 關閉 **「遊戲內重疊」**（In-Game Overlay）
- 關閉 **「即時重播」**、**「即時廣播」**（若不需要）

可減少 `_nvtopps.dll` 與 NVDisplay.Container 負載。

### 3.2 電源計畫

- **控制台** → **電源選項** → 選 **「高效能」**
- 或於 PowerShell（管理員）執行：  
  `powercfg /setactive 8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c`

有助 GPU 供電與時脈較穩定，減少 TDR/藍屏。

### 3.3 啟用小記憶體傾印（方便日後分析）

1. **Win + R** → `sysdm.cpl` → **進階** 索引標籤
2. **啟動及修復** → **設定**
3. **寫入偵錯資訊** 選 **「小記憶體傾印 (256 KB)」**
4. 確定後重開機

之後若再藍屏，可至 `C:\WINDOWS\Minidump\` 取得 `.dmp` 檔供分析。

### 3.4 散熱與硬體

- 使用 **HWiNFO64** 或 **GPU-Z** 監控 **GPU 溫度**
- 若長時間 > 85°C，請清理風扇、改善機殼對流或調整風扇曲線
- 確認電源供應器瓦數與接頭符合 RTX 4060 Ti 建議規格

### 3.5 Windows 更新

- **設定** → **Windows Update** → 檢查更新並安裝（含選用更新中的驅動與韌體）

---

## 四、問題對照

| 現象 | 建議 |
|------|------|
| 藍屏 0x119、NVDisplay.Container 崩潰 | 先執行 `repair_nvidia_stability.ps1`，再更新或 DDU 重裝驅動 |
| 玩遊戲或高負載時當機 | 檢查 GPU 溫度、電源計畫設為高效能、關閉 GeForce 重疊 |
| 更新驅動後仍當機 | 使用 DDU 在安全模式清除後再安裝最新驅動 |
| 想保留藍屏紀錄 | 啟用小記憶體傾印，傾印檔在 `C:\WINDOWS\Minidump\` |

---

## 五、相關檔案

- **修復腳本**：`scripts/repair_nvidia_stability.ps1`（需管理員）
- **錯誤匯出**：`logs/nvidia_errors_YYYYMMDD_HHMMSS.csv`
- **藍屏傾印**：`C:\WINDOWS\Minidump\*.dmp`

完成上述修復與優化後，若仍發生當機，請保留當日的 `Minidump` 與 `logs` 中的錯誤匯出檔，以便進一步分析。
