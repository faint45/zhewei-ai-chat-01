# 築未科技大腦 — 產品架構與商用訂閱

## 一、整體大邏輯

**未來整個大邏輯是：**

1. **一套 AI 模組**：遠端或本地都可以運行（同一套 Brain Bridge API）。
2. **後續開發的軟件或 APP**：都透過這套模組來做運算（統一接入 `/compute`、`/chat`、`/agent` 等）。
3. **商用化、供訂閱**：以訂閱制對外提供服務，軟件/APP 或終端用戶依方案訂閱後取得使用權。

因此不需要每套軟件各自接 AI，而是**集中由「築未科技大腦」提供運算**，新軟件/APP 只要設定 API 網址與認證即可接入。

---

## 二、架構關係（文字示意）

```
                    ┌─────────────────────────────────────┐
                    │  築未科技大腦（AI 模組）              │
                    │  遠端部署 或 本地部署 二選一/並存     │
                    │  Brain Bridge API (port 5100)        │
                    │  /compute, /chat, /agent, /login…    │
                    └─────────────────┬───────────────────┘
                                      │
         ┌────────────────────────────┼────────────────────────────┐
         │                            │                            │
         ▼                            ▼                            ▼
   ┌───────────┐              ┌───────────┐              ┌───────────┐
   │ 軟件 A    │              │ 軟件 B    │              │ APP / 網頁 │
   │ (營建/內部)│              │ (未來產品) │              │ (訂閱用戶) │
   └───────────┘              └───────────┘              └───────────┘
         │                            │                            │
         └────────────────────────────┴────────────────────────────┘
                         統一接入同一套 AI 模組
                         認證：API Key 或 帳號/密碼 Session
```

- **AI 模組**：可部署在本地（本機/內網）或遠端（雲端），對外提供同一組 API。
- **軟件/APP**：只認「一個 API 網址 + 認證方式」，不關心 AI 跑在本地還是雲端。
- **商用訂閱**：對外以訂閱制收費；訂閱身分可對應到 API Key 或帳號，用於計費與權限。

---

## 三、遠端 / 本地皆可運行

| 模式 | 說明 | API 網址範例 |
|------|------|----------------|
| **本地** | 本機或內網執行 Brain Bridge | `http://127.0.0.1:5100` 或 `http://192.168.x.x:5100` |
| **遠端** | 部署在 Render / Railway / 自建主機 | `https://zhewei-brain-xxx.onrender.com` |

軟件/APP 只需一個設定項：**大腦 API 的 base URL**。同一套程式碼，切換 URL 即可從本地改連遠端（或反過來）。  
部署方式請見：[上架到網路說明.md](上架到網路說明.md)

---

## 四、後續軟件 / APP 如何接入

所有「後續開發的軟件或 APP」都依下列方式運用這套模組做運算：

1. **設定 API 網址**  
   - 本地：`http://127.0.0.1:5100` 或內網 IP  
   - 遠端：雲端部署後的 HTTPS 網址  

2. **認證（二選一或並存）**  
   - **API Key**：請求標頭帶 `X-API-Key`（適合軟件/服務端）。  
   - **帳號密碼 + Session**：呼叫 `/auth/login` 取得 `session_token`，請求帶 `X-Session-Token`（適合網頁/APP 用戶登入）。  

3. **呼叫運算**  
   - 統一介面：`POST /compute`，body 含 `message`、`user_id`、`source`（device | software | web）。  
   - 或依需求使用 `/chat`、`/agent`、`/integrations/query` 等。  

詳細端點與範例請見：[接入說明_設備軟件網頁.md](接入說明_設備軟件網頁.md)

---

## 五、商用化、供訂閱 — 現狀與擴充方向

### 5.1 現有基礎（已具備）

- **認證**：API Key、帳號/密碼、Session Token（`/auth/login`、`/auth/me`、`/auth/logout`）。  
- **用量追蹤**：`ai_cost_tracker` 可記錄呼叫次數與估算費用（USD），可換算為台幣。  
- **預算上限**：每月新台幣上限（如 1000 元），超過後僅使用免費 AI，可作為「用量控管」起點。

以上足以區分「誰在用」（user_id / API Key），並做簡單用量統計，作為訂閱制的基礎。

### 5.2 訂閱制擴充要點（未來實作）

若要正式**商用供訂閱**，可在此基礎上擴充：

| 項目 | 說明 |
|------|------|
| **方案分級** | 例如：免費試用、個人版、團隊版、企業版；不同方案對應不同 API Key 或帳號群組。 |
| **用量額度** | 依訂閱方案限制：每月呼叫次數、或每月可消耗的 AI 成本上限（可沿用/擴充現有成本追蹤）。 |
| **計費與帳單** | 依用量或訂閱方案產生帳單；可對接金流（如 Stripe、藍新）或內部帳務系統。 |
| **授權驗證** | 軟件/APP 啟動時驗證訂閱是否有效（呼叫 API 時由後端檢查方案與額度）。 |

預留擴充模組：`integration_gateway.py`（設備/軟件註冊、未來可加授權驗證）、`ai_cost_tracker.py`（用量與成本，可擴為依 user/tenant 統計）。

### 5.3 小結

- **現在**：同一套 AI 模組可遠端/本地運行，任何軟件/APP 可透過 API 網址 + 認證接入做運算。  
- **商用訂閱**：在現有認證與用量基礎上，加上方案分級、額度與計費即可逐步實作訂閱制。

---

## 六、相關文件

| 文件 | 用途 |
|------|------|
| [接入說明_設備軟件網頁.md](接入說明_設備軟件網頁.md) | API 端點、認證方式、軟件/網頁接入範例 |
| [上架到網路說明.md](上架到網路說明.md) | 將 AI 模組上架到網路（Render / Railway / 自建） |
| [築未科技大腦_缺口與優化清單.md](築未科技大腦_缺口與優化清單.md) | **還缺什麼、可優化什麼**（訂閱、安全、維運、測試等） |
| [.env.example](.env.example) | 環境變數（API Key、AUTH_USERS、預算等） |

---

**總結**：  
您有一套**遠端或本地都可運行的 AI 模組**，後續開發的**軟件或 APP 都透過這套模組做運算**，並可在此基礎上**商用化、供訂閱**。現有架構已支援「統一 API + 認證 + 用量追蹤」，訂閱制只需在方案、額度與計費上擴充即可。
