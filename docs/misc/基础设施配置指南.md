# 基础设施配置 - 快速启动指南

## 📋 概述

本指南将帮助您完成系统构建第一阶段的两个关键任务：

1. ✅ **安装 Tailscale** - 实现免费的内网穿透
2. ✅ **配置 OpenSSH** - 允许远程 SSH 连接

完成后，您将能够：
- 从任何地方安全地访问您的主机
- 使用 VS Code 进行远程开发
- 从手机或笔电管理您的服务

---

## ⏱️ 预计时间

- **Tailscale 安装**：15-30 分钟
- **OpenSSH 配置**：10-20 分钟
- **总计**：25-50 分钟

---

## 🎯 快速开始

### 📱 任务 1: 安装 Tailscale

#### Step 1: 下载并安装（5 分钟）

1. **访问下载页面**
   ```
   https://tailscale.com/download/windows
   ```

2. **下载并安装 Windows 版本**
   - 下载 `.msi` 安装程序
   - 双击运行
   - 点击 "Install"

3. **登录 Tailscale**
   - 安装后自动打开浏览器
   - 使用 Google/Microsoft/GitHub 账号登录（推荐 Google）

4. **确认安装成功**
   - 系统托盘出现 Tailscale 图标
   - 显示为 "已连接" 状态

#### Step 2: 在其他设备安装（10 分钟）

**Android 手机：**
```
1. Google Play 搜索 "Tailscale"
2. 安装并登录（使用相同账号）
3. 允许 VPN 权限
```

**iOS 手机：**
```
1. App Store 搜索 "Tailscale"
2. 安装并登录（使用相同账号）
3. 在设置 > VPN 中配置
```

**笔电（macOS/Linux/Windows）：**
```
按照与 PC 相同的步骤安装
```

#### Step 3: 获取 IP 地址（2 分钟）

在 PC 上打开 PowerShell：

```powershell
tailscale status
```

**记录您的 Tailscale IP**（格式：100.x.x.x）

#### Step 4: 测试连接（3 分钟）

从笔电或手机测试：

```bash
# macOS/Linux
ping 100.x.x.x

# Windows
ping 100.x.x.x
```

如果可以 ping 通，说明 Tailscale 工作正常！

---

### 🔐 任务 2: 配置 OpenSSH

#### Step 1: 检查并安装（5 分钟）

**打开 PowerShell（管理员）**：

```powershell
# 检查是否已安装
Get-WindowsCapability -Online | Where-Object Name -like 'OpenSSH*'
```

**如果未安装**：
```powershell
# 安装 OpenSSH 服务器
Add-WindowsCapability -Online -Name OpenSSH.Server~~~~0.0.1.0

# 安装 OpenSSH 客户端
Add-WindowsCapability -Online -Name OpenSSH.Client~~~~0.0.1.0
```

如果提示需要重启，请按 `Y` 重启。

#### Step 2: 启动 SSH 服务（3 分钟）

```powershell
# 启动服务
Start-Service sshd

# 设置为自动启动
Set-Service -Name sshd -StartupType 'Automatic'

# 确认状态
Get-Service sshd
```

应该显示 `Status: Running`。

#### Step 3: 配置防火墙（2 分钟）

```powershell
# 添加防火墙规则
New-NetFirewallRule -Name 'OpenSSH-Server-In-TCP' -DisplayName 'OpenSSH Server (sshd)' -Enabled True -Direction Inbound -Protocol TCP -Action Allow -LocalPort 22
```

#### Step 4: 本地测试（2 分钟）

```powershell
# 测试本地连接
ssh localhost

# 输入密码，应该能够登录
```

#### Step 5: 从笔电测试（3 分钟）

在笔电上：

```bash
# 使用 Tailscale IP 连接
ssh 您的用户名@100.x.x.x

# 输入密码，应该能够登录
```

成功！您现在可以远程连接到您的主机了。

---

## 🚀 使用指南

### 从笔电使用 VS Code 远程开发

#### 1. 安装扩展

```
1. 打开 VS Code
2. Ctrl+Shift+X 打开扩展面板
3. 搜索 "Remote - SSH"
4. 安装 Microsoft 的扩展
```

#### 2. 配置 SSH

编辑 `~/.ssh/config` 文件：

```bash
Host zhuwei-home
    HostName 100.x.x.x  # 您的 Tailscale IP
    User 您的用户名     # Windows 用户名
```

#### 3. 连接

```
1. 按 F1 或 Ctrl+Shift+P
2. 输入 "Remote-SSH: Connect to Host"
3. 选择 "zhuwei-home"
4. 输入密码
```

### 从手机访问服务

在手机浏览器中输入：

```
# 网站服务
http://100.x.x.x:8000

# AI 聊天页面
http://100.x.x.x:8000/chat

# API 监控面板
http://100.x.x.x:8001
```

### 远程启动服务

通过 SSH 连接到主机后：

```bash
cd /c/Users/user/CodeBuddy/20260202120952

# 启动 Ollama 模式
一键启动_ollama模式.bat

# 启动监控面板
python monitoring_dashboard.py
```

---

## ✅ 检查清单

完成后，请确认以下项目：

### Tailscale
- [ ] PC 上已安装并登录 Tailscale
- [ ] 手机上已安装并登录 Tailscale
- [ ] 笔电上已安装并登录 Tailscale
- [ ] 所有设备状态为 "Online"
- [ ] 可以从笔电 ping 通 PC 的 Tailscale IP

### OpenSSH
- [ ] OpenSSH 服务器已安装
- [ ] OpenSSH 服务正在运行
- [ ] 防火墙规则已配置
- [ ] 可以通过 `ssh localhost` 本地连接
- [ ] 可以从笔电远程连接
- [ ] VS Code Remote - SSH 扩展已安装
- [ ] 可以通过 VS Code 连接到远程主机

### 测试
- [ ] 可以从手机访问 http://100.x.x.x:8000
- [ ] 可以从笔电使用 VS Code 远程开发
- [ ] 可以通过 SSH 远程启动服务

---

## 📊 进度追踪

| 任务 | 状态 | 完成时间 |
|------|------|----------|
| Tailscale 安装（PC） | ⬜ | _____ |
| Tailscale 安装（手机） | ⬜ | _____ |
| Tailscale 安装（笔电） | ⬜ | _____ |
| 获取 Tailscale IP | ⬜ | _____ |
| 测试 Tailscale 连接 | ⬜ | _____ |
| 检查 OpenSSH 安装 | ⬜ | _____ |
| 启动 SSH 服务 | ⬜ | _____ |
| 配置防火墙 | ⬜ | _____ |
| 本地 SSH 测试 | ⬜ | _____ |
| 远程 SSH 测试 | ⬜ | _____ |
| VS Code Remote SSH | ⬜ | _____ |
| 远程访问服务测试 | ⬜ | _____ |

---

## 🆘 遇到问题？

### Tailscale 相关问题

**无法连接？**
```powershell
# 检查状态
tailscale status

# 重启 Tailscale
net stop tailscale
net start tailscale

# 重新登录
tailscale up
```

**找不到设备？**
```
1. 确认所有设备使用相同的账号登录
2. 检查 Tailscale 管理面板：https://login.tailscale.com/admin/machines
3. 确认设备状态为 "Online"
```

### OpenSSH 相关问题

**无法启动服务？**
```powershell
# 检查服务状态
Get-Service sshd

# 查看错误日志
Get-EventLog -LogName Application -Source sshd -Newest 10
```

**无法连接？**
```powershell
# 检查防火墙
Get-NetFirewallRule -Name "OpenSSH-Server-In-TCP"

# 检查端口监听
netstat -ano | findstr ":22"
```

### VS Code Remote 问题

**无法连接？**
```
1. 先用命令行测试 SSH：
   ssh 用户名@100.x.x.x

2. 如果命令行能连接，但 VS Code 不能：
   - 关闭所有 VS Code 窗口
   - 删除 %USERPROFILE%\.vscode-server
   - 重新打开并连接
```

---

## 📚 详细文档

如果需要更详细的说明，请查看：

- **Tailscale 完整指南**：`TAILSCALE_SETUP.md`
- **OpenSSH 完整指南**：`OPENSSH_SETUP.md`
- **项目路线图**：`PROJECT_ROADMAP.md`

---

## 🎉 完成后

恭喜！完成这些配置后，您将拥有：

### ✅ 远程访问能力

1. **从任何地方访问主机**
   - 无需公网 IP
   - 端对端加密
   - 免费使用

2. **远程开发环境**
   - VS Code 远程编辑
   - 实时同步
   - 本地性能

3. **远程服务管理**
   - 启动/停止服务
   - 监控 API 调用
   - 查看日志

---

## 🚀 下一步行动

完成基础设施配置后，您可以：

1. **立即开始**：远程开发您的项目
2. **下一步**：配置 Rclone（Google Drive → Z 槽）
3. **继续**：完善监控系统或开始 AI 视觉开发

---

## 💡 提示

- **保持 Tailscale 运行**：所有设备上保持 Tailscale 应用打开
- **定期检查**：偶尔检查连接状态和服务状态
- **文档备份**：记录您的 Tailscale IP 和 SSH 配置

---

**需要帮助？** 查看详细文档或访问相关工具的官方文档。
