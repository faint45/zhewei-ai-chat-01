# 築未科技 — 八階段可執行性評估

**結論**：**可以**進行八階段；程式與接線已就緒，實際能否跑滿依**環境變數與本機服務**（Gemini key、Ollama、Claude key、視覺 input）而定。

---

## 一、八階段與依賴對照

| 階段 | 名稱 | 依賴組件 | 目前狀態 |
|------|------|----------|----------|
| **1** | 需求 (Requirement) | brain_server WebSocket `/ws` | ✅ 已就緒；接收 `{"text":"..."}` 即觸發 |
| **2** | 整合理解 (Understanding) | Gemini、Z/D 記憶（master_rules） | ⚠️ 需 `.env` 有 `GEMINI_API_KEY`；無則理解階段會失敗 |
| **3** | 安排 (Arrangement) | AgentManager 引擎分流（vision→Gemini, complex→Gemini/Claude, conversation→Ollama） | ⚠️ 同上；若為 conversation 且 Ollama 未啟用也會失敗 |
| **4** | 執行 (Execution) | TOOLS（run_command、write_file、vision_engine、Ollama/Claude） | ✅ 工具已接線；Ollama 未啟用時「單次任務」會報連線失敗；視覺需 input 有圖 |
| **5** | 確認 I (Confirmation I) | Ollama 檢核、ReAct Observation | ⚠️ 需本機 Ollama 運行 |
| **6** | 回饋修正 (Feedback & Fix) | Gemini/Claude 修復、TOOLS 寫入 | ✅ 有 Claude key 時可注入；無則靠 Gemini |
| **7** | 確認 II (Confirmation II) | Gemini 交叉驗證、第二意見 | ⚠️ 需 `GEMINI_API_KEY` |
| **8** | 完成與佈署 (Completion) | deploy_service、report_generator、update_web_admin | ✅ 已接線；報表寫 D/Z、進度推 WebSocket |

---

## 二、可執行條件整理

| 情境 | 條件 | 結果 |
|------|------|------|
| **完整八階段（單次任務）** | brain_server 運行 + `GEMINI_API_KEY` + Ollama 運行 | ✅ 可跑滿；階段 2、3、4、5、7 皆可用 |
| **僅 Gemini（無 Ollama）** | brain_server + `GEMINI_API_KEY`；Ollama 未啟用 | ⚠️ 可跑；若引擎選到 Ollama（conversation）會連線失敗 |
| **僅 Ollama（無 Gemini key）** | brain_server + Ollama 運行；無 GEMINI_API_KEY | ⚠️ 僅 conversation 類會用 Ollama；vision/complex 會失敗 |
| **視覺鏈（運算 + 報表）** | D 槽 venv_vision + `D:\brain_workspace\input` 有 .jpg/.png | ✅ 已接線；`python scripts/run_workflow_step.py --step 視覺與報表` 可跑 |
| **WebSocket 觸發** | 開管理介面 http://localhost:8000/admin 或 Railway URL，輸入文字送 `/ws` | ✅ 會走 AgentManager.run → 八階段流程 |

---

## 三、目前環境對「八階段」的影響

| 項目 | 狀態 | 對八階段的影響 |
|------|------|----------------|
| **brain_server** | 已啟動（端口 8000） | 階段 1 可接收；階段 8 可推播進度 |
| **GEMINI_API_KEY** | 需在 .env 設定 | 未設則階段 2、3、7 無法用 Gemini |
| **Ollama** | 目前未連線（E2E 曾報錯） | 未啟用則階段 4、5 若走 Ollama 會失敗 |
| **ANTHROPIC_API_KEY / CLAUDE_API_KEY** | 需在 .env 設定 | 有則階段 4、6 可注入 Claude |
| **D 槽 / venv_vision** | 已部屬 | 視覺鏈、報表、產出路徑可用 D |
| **Z 槽** | 可選（未掛載則用 D） | 報表可寫 ZHEWEI_MEMORY_ROOT（D 或 Z） |
| **update_web_admin / deploy_service** | 已接線 | 階段 8 可寫進度、觸發白名單指令 |

---

## 四、一句話結論

- **程式面**：八階段流程（需求→理解→安排→執行→確認→修正→交叉驗證→完成佈署）已接好，**可以**跑。
- **環境面**：要穩定跑滿建議：**設定 GEMINI_API_KEY、啟動 Ollama**；要編碼/修正再補 **CLAUDE_API_KEY**；視覺鏈在 input 放圖片即可。
- **觸發方式**：管理介面 WebSocket 輸入任務，或本機執行 `python scripts/run_workflow_step.py --step 單次任務 --task "任務內容"`。

---

*評估依據：需求到完成八階段流程.md、agent_logic.py、run_workflow_step.py、agent_tools、brain_server。*
