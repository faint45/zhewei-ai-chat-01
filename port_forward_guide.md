# 築未科技大腦 - 端口轉發配置指南

## 📊 您的網絡信息
- **公網IP**: `1.172.28.40`
- **本地IP**: `192.168.1.102`
- **服務端口**: `8000`

## 🚀 路由器配置步驟

### 步驟1: 登錄路由器管理界面
1. 打開瀏覽器，輸入路由器管理地址：
   - **常見地址**: `192.168.1.1` 或 `192.168.0.1`
   - **用戶名/密碼**: 通常在路由器背面標籤上

2. 如果不知道管理地址，可以查看：
   ```cmd
   ipconfig | findstr "Default Gateway"
   ```

### 步驟2: 找到端口轉發設置
不同品牌路由器位置可能不同：
- **TP-Link**: 轉發規則 → 虛擬服務器
- **ASUS**: 高級設置 → 網絡工具 → 端口轉發
- **Netgear**: 高級 → 端口轉發/端口觸發
- **D-Link**: 高級 → 端口轉發
- **小米**: 高級設置 → 端口轉發

### 步驟3: 添加端口轉發規則
填寫以下信息：

| 字段 | 值 | 說明 |
|------|-----|------|
| **服務名稱** | `築未科技大腦` | 自定義名稱 |
| **外部端口** | `8000` | 外網訪問端口 |
| **內部端口** | `8000` | 本地服務端口 |
| **協議** | `TCP` 或 `TCP/UDP` | 選擇TCP |
| **內部IP** | `192.168.1.102` | 您的電腦IP |
| **狀態** | `啟用` | 啟用規則 |

### 步驟4: 保存並重啟路由器
1. 點擊"保存"或"應用"按鈕
2. 可能需要重啟路由器使設置生效

## 🔧 創建自動化配置腳本

### Windows防火牆規則（管理員權限運行）
```batch
@echo off
echo 創建防火牆規則...
netsh advfirewall firewall add rule name="築未科技大腦" dir=in action=allow protocol=TCP localport=8000
echo 防火牆規則創建完成！
```

### 啟動腳本
```batch
@echo off
echo ========================================
echo    築未科技大腦 - 外網訪問啟動腳本
echo ========================================

set AI_MODEL_TYPE=ollama
set OLLAMA_MODEL=gemma3:4b

echo.
echo 🌐 外網訪問信息：
echo 公網IP: 1.172.28.40
echo 訪問地址: http://1.172.28.40:8000
echo.
echo 📱 手機/外部設備訪問：
echo 1. 確保路由器端口轉發已配置
echo 2. 在瀏覽器輸入: http://1.172.28.40:8000
echo.

echo 🚀 啟動服務...
python brain_server.py
```

## 🌐 外網訪問測試

配置完成後，通過以下方式測試：

### 1. 本地測試
```bash
# 本地訪問測試
curl http://localhost:8000/api/status
```

### 2. 局域網測試
```bash
# 使用手機（同一WiFi）訪問
http://192.168.1.102:8000
```

### 3. 外網測試
```bash
# 使用手機數據網絡或朋友網絡訪問
http://1.172.28.40:8000
```

## ⚠️ 注意事項

1. **公網IP可能變化**：大多數家庭寬帶使用動態IP
2. **安全性**：端口轉發會暴露服務到公網
3. **ISP限制**：某些ISP可能限制家庭寬帶的端口轉發

## 🔄 動態DNS（可選）

如果公網IP經常變化，建議使用動態DNS服務：
- **免費服務**: No-IP、DuckDNS
- **設置方法**: 在路由器中配置DDNS

## 📞 常見問題

### Q: 無法訪問怎麼辦？
A: 檢查：
1. 路由器端口轉發是否正確配置
2. Windows防火牆是否允許端口8000
3. 服務是否正常運行

### Q: 公網IP變化了怎麼辦？
A: 重新運行腳本獲取新IP，或設置動態DNS

### Q: 如何提高安全性？
A: 考慮：
1. 使用HTTPS（需要SSL證書）
2. 添加基本身份驗證
3. 限制訪問IP範圍

---

💡 **提示**: 配置完成後，您就可以在任何有網絡的地方訪問築未科技大腦了！