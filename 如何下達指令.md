# 築未科技 — 如何下達指令

## 一、對「築未大腦」下指令（WebSocket Port 8000）

大腦服務啟動後（`brain_server.py`，Port 8000），可透過 **WebSocket** 送指令，大腦會以雙引擎（Gemini + Ollama）與 ReAct 工具執行並回傳結果。

### 1. 連線位址

- **本機**：`ws://127.0.0.1:8000/ws`
- **同網段**（例：手機）：`ws://<本機 IP>:8000/ws`

### 2. 訊息格式

送 **JSON** 或 **純文字** 皆可：

| 格式 | 範例 |
|------|------|
| JSON（建議） | `{"text": "檢查 report_generator.py 寫入 Z 槽那段"}` |
| 或 | `{"message": "整理點雲，幫我改 point_cloud_config"}` |
| 純文字 | 直接送 `檢查這段資料庫存取程式碼`，後端會當成 `{"text": "..."}` 處理 |

### 3. 下達方式

- **瀏覽器**：開 `http://127.0.0.1:8000`（根路徑為專案靜態頁）；若要做對話測試，可用開發者工具 Console 連 WebSocket，或使用下方「簡易測試頁」。
- **腳本／設備**：用各語言 WebSocket 客戶端連 `ws://<IP>:8000/ws`，送出 `{"text":"你的指令"}`，接收 JSON 回覆（`type`、`content` 等）。
- **簡易測試頁**：在專案根目錄起一個 HTML，內含連到 `ws://127.0.0.1:8000/ws` 的 script，輸入框送 `{"text":"..."}` 即可（可參考 `public/brain-api-demo.html` 的邏輯，改為連 8000 與 `/ws`）。

### 4. 健康檢查

```bash
# 確認服務有起來
curl http://127.0.0.1:8000/health
# 應回傳 {"ok":true,"service":"zhewei_brain","status":"healthy"}
```

---

## 二、對「Cursor / Agent / Skills」下指令（開發時）

在 Cursor 或支援 Skills 的環境裡，用**關鍵字**觸發對應技能，讓 AI 自動載入規範與流程，省 Token。詳見 ** [低Token聰明工作流.md](低Token聰明工作流.md)**。

### 原則摘要

1. **一則訊息、一個意圖**：一次只做一件事，觸發 1～2 個技能即可。
2. **關鍵字觸發**：例如「檢查這段**資料庫**存取」→ supabase-postgres-best-practices；「**整理點雲**」→ zhewei-pointcloud-cli；「**先寫計畫**」→ writing-plans。
3. **用 @ 取代貼文**：`@檔名` 或 `@資料夾` 讓 AI 讀檔，不要整份貼在對話裡。

### 速查

| 你想做的事 | 建議這樣說 |
|------------|------------|
| 資料庫/Supabase | 「檢查這段**資料庫**存取」「**Supabase** 查詢效能」 |
| 點雲/LAS | 「**整理點雲**」「**LAS** 歸檔」 |
| 營造規範 | 「依**公共工程品質**」「**標線規範**」 |
| 除錯 | 「**除錯**這段」「**root cause**」 |
| 完成前檢查 | 「**完成前驗證**」「確認路徑再回我」 |
| 先計畫再做 | 「**先寫計畫**」「拆任務再實作」 |

---

## 三、對「服務／系統」下指令（啟動、停止、重啟）

### 1. 一鍵啟動大腦（本機）

```batch
啟動_築未科技大腦_2.1版.bat
```

會執行：環境診斷 → 守護進程 → brain_server (8000) → site_monitor。

### 2. 僅啟動大腦（無守護）

```powershell
cd c:\Users\user\Desktop\zhe-wei-tech
python brain_server.py
```

### 3. Windows 服務（ZheweiBrain）

| 動作 | 指令 |
|------|------|
| 安裝服務 | **以系統管理員**執行 `安装築未大腦服務.bat` |
| 啟動 | `nssm start ZheweiBrain` 或「服務」管理員中啟動 |
| 停止 | `nssm stop ZheweiBrain` |
| 卸載 | **以系統管理員**執行 `卸載築未大腦服務.bat` |

（需已安裝 NSSM 至 `C:\tools\nssm\`，或修改 bat 內路徑。）

### 4. 健康檢查（確認有在跑）

```powershell
Invoke-RestMethod -Uri "http://127.0.0.1:8000/health" -Method Get
# 或
curl http://127.0.0.1:8000/health
```

---

## 對照總表

| 對象 | 下達方式 | 說明 |
|------|----------|------|
| **築未大腦** | WebSocket `ws://<IP>:8000/ws`，送 `{"text":"指令"}` 或 `{"message":"指令"}` | 雙引擎 + ReAct 工具，即時回傳 |
| **Cursor / Skills** | 在對話中寫關鍵字（如「資料庫」「整理點雲」「先寫計畫」） | 觸發對應技能，低 Token 工作流 |
| **本機服務** | 執行 `啟動_築未科技大腦_2.1版.bat` 或 `python brain_server.py` | 啟動大腦 |
| **Windows 服務** | `安装築未大腦服務.bat` / `nssm start|stop ZheweiBrain` / `卸載築未大腦服務.bat` | 開機自啟、常駐 |

---

*更多佈署選項見 [佈署指南.md](佈署指南.md)；對外上網、API 與設備接入見 [接入說明_設備軟件網頁.md](接入說明_設備軟件網頁.md)（需 Brain Bridge API，Port 5100）。*
