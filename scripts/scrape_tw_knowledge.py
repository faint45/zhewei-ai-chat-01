#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
築未科技 — 台灣交通設施 / 車輛辨識 / 營建材料 知識抓取與學習腳本

三大資料來源：
1. 台灣高速公路/快速道路/一般道路交通設施規定
2. 台灣車輛報關資料（廠牌/車型/規格）加強車輛辨識
3. 大宗營建材料、物料、機具

全部寫入 ChromaDB jarvis_training 知識庫
"""

from __future__ import annotations

import hashlib
import json
import os
import sys
import time
from datetime import datetime
from pathlib import Path

# 確保可以 import 學習系統
PROJECT_DIR = Path(__file__).resolve().parent.parent
JARVIS_DIR = PROJECT_DIR / "Jarvis_Training"
sys.path.insert(0, str(JARVIS_DIR))
sys.path.insert(0, str(PROJECT_DIR))

try:
    from local_learning_system import get_collection, ollama_embed, learn, log_event
    print("[OK] local_learning_system 匯入成功")
except ImportError as e:
    print(f"[ERROR] 無法匯入 local_learning_system: {e}")
    sys.exit(1)

# =====================================================================
# 工具函式
# =====================================================================

def kb_doc_id(prefix: str, text: str) -> str:
    h = hashlib.sha1(text.encode("utf-8", errors="ignore")).hexdigest()[:16]
    return f"{prefix}_{h}"


def batch_learn(entries: list[dict], source: str, prefix: str = "tw") -> dict:
    """批次寫入知識庫
    entries: [{"q": "問題/標題", "a": "答案/內容"}, ...]
    """
    coll = get_collection()
    total = len(entries)
    written = 0
    skipped = 0
    errors = 0

    for i, entry in enumerate(entries):
        q = (entry.get("q") or "").strip()
        a = (entry.get("a") or "").strip()
        if not q or not a:
            skipped += 1
            continue

        doc_id = kb_doc_id(prefix, q + a)
        # 檢查是否已存在
        try:
            got = coll.get(ids=[doc_id], include=[])
            if got.get("ids"):
                skipped += 1
                continue
        except Exception:
            pass

        try:
            doc = f"Q: {q}\nA: {a}"
            emb = ollama_embed(doc)
            coll.add(
                documents=[doc],
                metadatas=[{
                    "question": q[:200],
                    "source": source,
                    "time": datetime.now().strftime("%Y-%m-%d %H:%M:%S"),
                }],
                ids=[doc_id],
                embeddings=[emb],
            )
            written += 1
            if (i + 1) % 20 == 0:
                print(f"  [{source}] {i+1}/{total} written={written} skipped={skipped}")
        except Exception as e:
            errors += 1
            if errors <= 3:
                print(f"  [WARN] 寫入失敗: {e}")

    print(f"  [{source}] 完成: total={total} written={written} skipped={skipped} errors={errors}")
    return {"total": total, "written": written, "skipped": skipped, "errors": errors}


# =====================================================================
# 1. 台灣交通道路設施規定
# =====================================================================

def get_traffic_facility_knowledge() -> list[dict]:
    """台灣高速公路/快速道路/一般道路交通設施規定"""
    entries = []

    # ── 高速公路設施 ──
    entries.extend([
        {"q": "台灣高速公路的車道標線規定有哪些？",
         "a": "台灣高速公路車道標線規定（依道路交通標誌標線號誌設置規則）：\n"
              "1. 白色虛線：同向車道分隔線，可變換車道\n"
              "2. 白色實線：路面邊線或不可變換車道線\n"
              "3. 黃色實線：分向限制線，禁止跨越\n"
              "4. 雙白實線：禁止變換車道\n"
              "5. 槽化線（斜線區）：導引車流，禁止駛入\n"
              "6. 路面文字標記：速限、出口預告、車道指示\n"
              "7. 減速標線：橫向白色短線，提醒減速\n"
              "8. 高速公路最外側車道為大型車專用道（部分路段）"},

        {"q": "台灣高速公路的交通標誌種類有哪些？",
         "a": "台灣高速公路交通標誌分類：\n"
              "【警告標誌】黃底黑圖：前方施工、匝道匯入、彎道、下坡、隧道等\n"
              "【禁制標誌】白底紅框：速限、禁止超車、禁止大型車、禁止迴轉\n"
              "【指示標誌】綠底白字：交流道出口、里程、方向指示\n"
              "【輔助標誌】白底黑字：距離、車道指引、服務區預告\n"
              "【施工標誌】橘底黑字：施工區域、改道、車道縮減\n"
              "【電子看板（CMS）】可變資訊標誌：即時路況、速限調整、事故警示\n"
              "高速公路標誌尺寸較一般道路大，反光係數要求更高"},

        {"q": "台灣高速公路的護欄與安全設施有哪些？",
         "a": "台灣高速公路安全設施：\n"
              "1. 中央分隔護欄：混凝土紐澤西護欄（New Jersey Barrier）、鋼板護欄、鋼索護欄\n"
              "2. 路側護欄：W型鋼板護欄、三波鋼板護欄、混凝土護欄\n"
              "3. 防眩板：中央分隔帶上防止對向車燈眩光\n"
              "4. 反光導標：設於護欄上方，夜間引導視線\n"
              "5. 防撞桶（緩衝設施）：交流道分叉處、匝道端部\n"
              "6. 輪胎防滑帶：下坡路段\n"
              "7. 避車彎：緊急停車區域\n"
              "8. 緊急電話：每隔約 1 公里設置\n"
              "9. 消防栓與滅火器：隧道內每 50 公尺\n"
              "10. 逃生門/避難連絡通道：長隧道內"},

        {"q": "台灣高速公路速限規定是什麼？",
         "a": "台灣高速公路速限規定（高速公路及快速公路交通管制規則）：\n"
              "【最高速限】\n"
              "- 一般路段：110 km/h（部分路段 100 km/h）\n"
              "- 隧道路段：依標誌（通常 80-90 km/h）\n"
              "- 施工路段：依標誌（通常 60-80 km/h）\n"
              "【最低速限】\n"
              "- 內側車道：不得低於 100 km/h（三車道以上）\n"
              "- 外側車道：不得低於 60 km/h\n"
              "【車種限速】\n"
              "- 大型車：最高 90 km/h（部分路段 80 km/h）\n"
              "- 拖吊車/工程車：最高 60 km/h\n"
              "- 超速罰鍰：超速 20 km/h 以下罰 3000-6000 元，超速 40 km/h 以上罰 6000-24000 元"},

        {"q": "台灣高速公路的收費設施（ETC）規格是什麼？",
         "a": "台灣高速公路電子收費系統（ETC/eTag）：\n"
              "1. 系統：遠通電收 FETC 營運\n"
              "2. 技術：RFID（Radio Frequency Identification）\n"
              "3. eTag 貼紙：貼於擋風玻璃內側\n"
              "4. 門架式偵測：每個收費點設有門架式天線\n"
              "5. 計費方式：里程計費，每公里 1.2 元（小型車）\n"
              "6. 大型車費率：每公里 1.5-2.4 元（依車種）\n"
              "7. 偵測設備：紅外線攝影機 + RFID 讀取器\n"
              "8. 車牌辨識：作為 eTag 失效時的備援偵測\n"
              "9. 門架間距：約 2-5 公里"},

        {"q": "台灣高速公路交流道設施規定有哪些？",
         "a": "台灣高速公路交流道設施：\n"
              "1. 匝道類型：鑽石型、苜蓿葉型、喇叭型、系統交流道\n"
              "2. 匝道速限：通常 40-60 km/h\n"
              "3. 加速車道：最短 200 公尺\n"
              "4. 減速車道：最短 150 公尺\n"
              "5. 匝道儀控（Ramp Metering）：尖峰時段控制匯入車流\n"
              "6. 預告標誌：2 公里、1 公里、500 公尺前預告\n"
              "7. 出口編號：依里程數編號（如：國1 中壢交流道 62K）\n"
              "8. 收費門架：設於交流道前後"},

        {"q": "台灣高速公路的隧道安全設施有哪些？",
         "a": "台灣高速公路隧道安全設施（以雪山隧道為例）：\n"
              "1. 通風系統：縱流式通風（噴流風機）+ 橫流式通風\n"
              "2. 照明系統：入口段加強照明、中間段基本照明、出口段過渡照明\n"
              "3. 消防設備：每 50m 消防栓、每 250m 泡沫滅火設備\n"
              "4. 避難設施：人行/車行連絡通道（每 350m）\n"
              "5. 監控系統：CCTV 攝影機、車輛偵測器、火災偵測器\n"
              "6. 廣播系統：緊急廣播、FM 轉播\n"
              "7. 資訊看板：可變資訊標誌（CMS）\n"
              "8. 速限：80 km/h，禁止變換車道\n"
              "9. 安全間距：50 公尺以上\n"
              "10. 禁止事項：禁止超車、禁止停車、禁止載運危險物品"},
    ])

    # ── 快速道路設施 ──
    entries.extend([
        {"q": "台灣快速道路與高速公路的設施差異是什麼？",
         "a": "台灣快速道路 vs 高速公路設施差異：\n"
              "【快速道路特點】\n"
              "1. 速限較低：最高 80-100 km/h（依路段）\n"
              "2. 部分平面交叉：有號誌控制的平面路口\n"
              "3. 護欄等級較低：部分路段使用 W 型護欄\n"
              "4. 無收費：大部分免費（部分例外如台 61 線部分路段）\n"
              "5. 機車可行駛：部分快速道路開放 550cc 以上重機\n"
              "6. 路肩較窄：通常 1.5-2.5 公尺\n"
              "【共同設施】\n"
              "- 交流道匝道、加減速車道\n"
              "- 電子看板（CMS）\n"
              "- 反光導標、防撞設施\n"
              "- 緊急電話（部分路段）\n"
              "台灣主要快速道路：台 61（西濱）、台 62（萬里-瑞濱）、台 64（八里-新店）、台 65（土城-五股）、台 66（觀音-大溪）、台 68（南寮-竹東）、台 72（後龍-汶水）、台 74（彰化-霧峰）、台 76（芳苑-草屯）、台 78（台西-古坑）、台 82（東石-水上）、台 84（北門-玉井）、台 86（台南-關廟）、台 88（鳳山-竹田）"},

        {"q": "台灣快速道路的匝道管制設施有哪些？",
         "a": "台灣快速道路匝道管制設施：\n"
              "1. 匝道號誌：紅綠燈控制匯入車流（尖峰時段啟用）\n"
              "2. 車輛偵測器（VD）：感應線圈或微波偵測器\n"
              "3. 閉路電視（CCTV）：監控匝道車流\n"
              "4. 可變資訊標誌（CMS）：顯示前方路況\n"
              "5. 匝道封閉設施：活動式護欄、警示燈\n"
              "6. 速限標誌：匝道通常 40-60 km/h\n"
              "7. 禁止標誌：禁止行人、禁止非汽車"},
    ])

    # ── 一般道路設施 ──
    entries.extend([
        {"q": "台灣一般道路的交通號誌設施有哪些？",
         "a": "台灣一般道路交通號誌設施（依道路交通標誌標線號誌設置規則）：\n"
              "【行車管制號誌】\n"
              "1. 三色號誌：紅黃綠（直徑 20cm 或 30cm）\n"
              "2. 箭頭號誌：左轉/直行/右轉專用\n"
              "3. 閃光號誌：閃紅燈（停車再開）、閃黃燈（減速注意）\n"
              "4. 行人號誌：小綠人倒數計時\n"
              "5. 車道管制號誌：紅X/綠箭頭（調撥車道）\n"
              "【號誌桿件】\n"
              "- 懸臂式：跨越車道上方\n"
              "- 柱立式：路側設置\n"
              "- 門架式：跨越整個路面\n"
              "【智慧號誌】\n"
              "- 感應式號誌：車輛偵測器觸發\n"
              "- 適應性號誌控制（SCATS/SCOOT）\n"
              "- 行人觸動號誌"},

        {"q": "台灣一般道路的標線種類與意義是什麼？",
         "a": "台灣一般道路標線種類：\n"
              "【縱向標線】\n"
              "1. 行車分向線（黃虛線）：雙向分隔，可超車\n"
              "2. 分向限制線（黃實線/雙黃線）：禁止跨越\n"
              "3. 車道線（白虛線）：同向車道分隔\n"
              "4. 路面邊線（白實線）：車道外側邊界\n"
              "5. 禁止變換車道線（雙白實線）\n"
              "【橫向標線】\n"
              "6. 停止線：白色實線，寬 30cm\n"
              "7. 讓路線：白色雙虛線\n"
              "8. 行人穿越道（斑馬線）：白色平行線\n"
              "9. 自行車穿越道：綠色標線\n"
              "【特殊標線】\n"
              "10. 網狀線（黃色）：禁止停車\n"
              "11. 槽化線：導引車流\n"
              "12. 停車格：白色/紅色/黃色/藍色（身障）\n"
              "13. 公車專用道標線：紅色\n"
              "14. 機車待轉區：白色方框"},

        {"q": "台灣道路的測速設施種類有哪些？",
         "a": "台灣道路測速設施種類：\n"
              "1. 固定式測速照相：雷達式或感應線圈式\n"
              "2. 區間測速：計算兩點間平均速度（如蘇花改、雪隧）\n"
              "3. 移動式測速：警方手持雷達槍或三腳架式\n"
              "4. 闖紅燈照相：感應線圈 + 攝影機\n"
              "5. 多功能測速照相：同時偵測超速、闖紅燈、未繫安全帶\n"
              "6. 科技執法：AI 辨識違規（未打方向燈、違規停車、佔用公車道）\n"
              "【辨識特徵】\n"
              "- 固定式：通常有明顯的方形或圓形攝影機箱\n"
              "- 區間測速：入口/出口各一組攝影機\n"
              "- 前方 300m 需設置警告標誌\n"
              "- 夜間會有紅外線補光（不可見光）"},

        {"q": "台灣道路的人行設施有哪些？",
         "a": "台灣道路人行設施：\n"
              "1. 人行道：寬度至少 1.5m（無障礙 1.8m）\n"
              "2. 行人穿越道（斑馬線）：寬 3-6m\n"
              "3. 行人號誌：小綠人 + 倒數秒數\n"
              "4. 行人觸動按鈕：按壓後啟動行人綠燈\n"
              "5. 庇護島（安全島）：道路中央行人等候區\n"
              "6. 天橋/地下道：跨越主要幹道\n"
              "7. 無障礙坡道：路緣斜坡、導盲磚\n"
              "8. 護欄/圍籬：防止行人穿越\n"
              "9. 照明設施：路燈、行人專用照明\n"
              "10. 標誌：行人專用區、行人優先區"},

        {"q": "台灣道路的排水與附屬設施有哪些？",
         "a": "台灣道路排水與附屬設施：\n"
              "【排水設施】\n"
              "1. 路面排水：橫向坡度 1.5-4%\n"
              "2. 邊溝：U 型溝、L 型溝\n"
              "3. 集水井（雨水口）：每 20-40m\n"
              "4. 涵管/箱涵：穿越道路下方\n"
              "5. 滯洪池：大型道路工程\n"
              "【照明設施】\n"
              "6. 路燈：LED 路燈（高壓鈉燈逐步汰換）\n"
              "7. 隧道照明：入口段/過渡段/基本段\n"
              "8. 交流道照明：高桿照明\n"
              "【其他附屬設施】\n"
              "9. 隔音牆：住宅區旁\n"
              "10. 植栽帶：中央分隔帶、路側\n"
              "11. 公共藝術：部分重要路段\n"
              "12. 里程碑：每公里設置"},
    ])

    # ── 道路標誌辨識重點 ──
    entries.extend([
        {"q": "台灣道路標誌的顏色與形狀辨識規則是什麼？",
         "a": "台灣道路標誌辨識規則（視覺辨識重點）：\n"
              "【形狀辨識】\n"
              "- 圓形：禁制標誌（限速、禁止）\n"
              "- 三角形（尖朝上）：警告標誌\n"
              "- 倒三角形：讓路標誌\n"
              "- 八角形：停車再開（STOP）\n"
              "- 方形/矩形：指示標誌、輔助標誌\n"
              "- 菱形：施工警告\n"
              "【顏色辨識】\n"
              "- 紅色：禁止、停止\n"
              "- 黃色/橘色：警告、施工\n"
              "- 綠色：指示方向（高速公路）\n"
              "- 藍色：指示（一般道路）、服務設施\n"
              "- 白色：輔助說明\n"
              "- 棕色：觀光景點\n"
              "【AI 辨識建議】\n"
              "- 標誌通常位於道路右側或上方\n"
              "- 高速公路標誌尺寸：60-300cm\n"
              "- 一般道路標誌尺寸：45-90cm\n"
              "- 反光材料：鑽石級（高速公路）、工程級（一般道路）"},

        {"q": "台灣常見的道路施工安全設施有哪些？",
         "a": "台灣道路施工安全設施（依道路交通安全規則）：\n"
              "1. 施工警告標誌：橘底黑字，前方施工\n"
              "2. 交通錐：橘色反光錐，高 45-90cm\n"
              "3. 拒馬/路障：A 型拒馬、水泥護欄\n"
              "4. 警示燈：黃色閃光燈、箭頭導引燈\n"
              "5. 反光背心：施工人員必穿\n"
              "6. 施工圍籬：高 1.2m 以上\n"
              "7. 導引標誌：車道縮減、改道指示\n"
              "8. 速限標誌：施工區降速\n"
              "9. 交通管制人員：手持指揮棒\n"
              "10. 夜間照明：施工區域照明\n"
              "11. 防撞緩衝車（TMA）：高速公路施工必備\n"
              "12. 可變資訊標誌車（CMS 車）：移動式電子看板"},
    ])

    return entries


# =====================================================================
# 2. 台灣車輛辨識資料
# =====================================================================

def get_vehicle_recognition_knowledge() -> list[dict]:
    """台灣車輛廠牌/車型/規格/車牌格式 — 加強視覺辨識"""
    entries = []

    # ── 台灣車牌格式 ──
    entries.extend([
        {"q": "台灣車牌號碼格式與辨識規則是什麼？",
         "a": "台灣車牌號碼格式（2024年最新）：\n"
              "【自用小客車】\n"
              "- 新式：ABC-1234（3英文+4數字，白底黑字）\n"
              "- 舊式：AB-1234（2英文+4數字）\n"
              "- 電動車：綠底白字\n"
              "【營業用小客車（計程車）】\n"
              "- 格式同上，黃底紅字\n"
              "【大型車】\n"
              "- 大客車：AB-123（2英文+3數字，白底紅字）\n"
              "- 大貨車：AB-123（白底綠字）\n"
              "- 營業大貨車：黃底黑字\n"
              "【機車】\n"
              "- 普通重型：ABC-1234（白底黑字）\n"
              "- 輕型機車：綠底白字\n"
              "- 大型重型機車（紅牌）：黃底黑字（550cc 以上）\n"
              "- 大型重型機車（黃牌）：白底黑字（250-550cc）\n"
              "【特殊車牌】\n"
              "- 外交車：藍底白字\n"
              "- 軍用車：綠底白字\n"
              "- 臨時牌：紅底白字\n"
              "【車牌尺寸】\n"
              "- 汽車：32cm × 15cm\n"
              "- 機車：22cm × 12cm\n"
              "【AI 辨識重點】\n"
              "- 字體：標準中華民國車牌字體\n"
              "- 前後牌：汽車前後各一，機車僅後方\n"
              "- 反光材料：夜間可辨識"},

        {"q": "台灣車牌的英文字母編碼規則是什麼？",
         "a": "台灣車牌英文字母編碼規則：\n"
              "【排除字母】I、O、Q（避免與數字混淆）\n"
              "【自用小客車編碼】\n"
              "- 第一碼代表監理站轄區（A=台北、B=台中、C=高雄等）\n"
              "- 新式三碼英文已不嚴格對應轄區\n"
              "【營業車】\n"
              "- 計程車通常以 T 開頭\n"
              "- 租賃車以 R 開頭\n"
              "【大型車】\n"
              "- 大客車：K 系列\n"
              "- 大貨車：各字母\n"
              "【機車】\n"
              "- 普通重型：各字母\n"
              "- 大型重型：特定字母開頭"},
    ])

    # ── 台灣常見車輛廠牌 ──
    entries.extend([
        {"q": "台灣市場常見的汽車廠牌有哪些？如何視覺辨識？",
         "a": "台灣市場常見汽車廠牌與視覺辨識特徵：\n"
              "【國產/合資品牌】\n"
              "1. TOYOTA（和泰）：T 字標誌，台灣市佔率最高\n"
              "   - 熱門車型：Corolla Cross、RAV4、Camry、Yaris、Altis、Vios\n"
              "2. HONDA（台灣本田）：H 字標誌\n"
              "   - 熱門車型：CR-V、HR-V、Fit、Civic\n"
              "3. NISSAN（裕隆日產）：圓形 NISSAN 標誌\n"
              "   - 熱門車型：Kicks、X-Trail、Sentra、Tiida\n"
              "4. MITSUBISHI（中華三菱）：三菱鑽石標誌\n"
              "   - 熱門車型：Outlander、Eclipse Cross、Colt Plus\n"
              "5. FORD（福特六和）：藍色橢圓 Ford 標誌\n"
              "   - 熱門車型：Focus、Kuga、Ranger\n"
              "6. HYUNDAI（南陽現代）：斜 H 標誌\n"
              "   - 熱門車型：Tucson、Venue、Santa Fe\n"
              "7. MG（中華 MG）：八角形 MG 標誌\n"
              "   - 熱門車型：HS、ZS\n"
              "【進口品牌】\n"
              "8. MERCEDES-BENZ：三芒星標誌\n"
              "9. BMW：藍白圓標\n"
              "10. LEXUS：L 字標誌\n"
              "11. AUDI：四環標誌\n"
              "12. VOLVO：斜槓圓標\n"
              "13. MAZDA：展翅 M 標誌\n"
              "14. SUBARU：六連星標誌\n"
              "15. SUZUKI：S 字標誌\n"
              "16. KIA：新式文字標誌\n"
              "17. VOLKSWAGEN：VW 標誌\n"
              "18. PORSCHE：盾形標誌\n"
              "19. TESLA：T 字標誌（電動車）\n"
              "20. LUXGEN（納智捷）：L 字標誌（台灣品牌）"},

        {"q": "台灣常見的機車廠牌有哪些？如何視覺辨識？",
         "a": "台灣常見機車廠牌與視覺辨識特徵：\n"
              "【燃油機車】\n"
              "1. KYMCO（光陽）：台灣市佔率最高\n"
              "   - 熱門車型：GP125、Many125、Racing S、AK550\n"
              "   - 標誌：KYMCO 文字\n"
              "2. SYM（三陽）：\n"
              "   - 熱門車型：DRG158、JET SL、MMBCU、FNX\n"
              "   - 標誌：SYM 文字\n"
              "3. YAMAHA（台灣山葉）：\n"
              "   - 熱門車型：FORCE、CYGNUS、SMAX、MT-15\n"
              "   - 標誌：三叉音叉\n"
              "4. HONDA：\n"
              "   - 熱門車型：CB150R、MSX125\n"
              "5. SUZUKI：\n"
              "   - 熱門車型：GSX-R150、Address\n"
              "6. KAWASAKI：\n"
              "   - 熱門車型：Ninja 400、Z400\n"
              "【電動機車】\n"
              "7. GOGORO：\n"
              "   - 熱門車型：VIVA、S2、Delight、SuperSport\n"
              "   - 特徵：無排氣管、換電站\n"
              "8. eMoving（中華 eMOVING）：\n"
              "   - 熱門車型：iE125\n"
              "9. AEON（宏佳騰）：\n"
              "   - 熱門車型：Ai-1 Sport\n"
              "【辨識重點】\n"
              "- 機車通常有明顯廠牌標誌在車頭或車身\n"
              "- 電動機車無排氣管是最大辨識特徵\n"
              "- 大型重機體型明顯較大"},

        {"q": "台灣常見的商用車輛與特殊車輛有哪些？",
         "a": "台灣常見商用車輛與特殊車輛：\n"
              "【小型商用車】\n"
              "1. 廂型車：Toyota Hiace、VW Caddy、Ford Tourneo\n"
              "2. 貨卡：Toyota Hilux、Ford Ranger、Mitsubishi Triton\n"
              "3. 小貨車：中華菱利（Veryca）、Toyota Town Ace\n"
              "【大型商用車】\n"
              "4. 大貨車：HINO（日野）、FUSO（三菱扶桑）、ISUZU（五十鈴）\n"
              "5. 聯結車/拖車頭：SCANIA、VOLVO、MAN、DAF\n"
              "6. 大客車：HINO、DAEWOO、YUTONG（宇通）\n"
              "7. 混凝土預拌車：旋轉攪拌桶，通常 8-12 立方米\n"
              "8. 砂石車：後傾卸斗，通常 15-20 噸\n"
              "【特殊車輛】\n"
              "9. 消防車：紅色車身\n"
              "10. 救護車：白色車身 + 紅色條紋\n"
              "11. 警車：白色 + 藍色條紋\n"
              "12. 垃圾車：黃色車身\n"
              "13. 清潔車（掃街車）：橘色/黃色\n"
              "14. 拖吊車：黃色閃光燈\n"
              "15. 工程車：橘色閃光燈\n"
              "【AI 辨識重點】\n"
              "- 車身顏色是區分特殊車輛的關鍵\n"
              "- 商用車通常有公司名稱/電話塗裝\n"
              "- 大型車車頭廠牌標誌明顯"},

        {"q": "台灣車輛的車身顏色分布統計是什麼？",
         "a": "台灣車輛車身顏色分布（AI 辨識參考）：\n"
              "【小客車常見顏色排名】\n"
              "1. 白色：約 35%（最常見）\n"
              "2. 黑色：約 20%\n"
              "3. 灰色/銀色：約 18%\n"
              "4. 藍色：約 8%\n"
              "5. 紅色：約 7%\n"
              "6. 其他（棕/綠/黃/橘）：約 12%\n"
              "【機車常見顏色】\n"
              "1. 白色/銀色：最常見\n"
              "2. 黑色：次常見\n"
              "3. 紅色/藍色：較常見\n"
              "4. 消光色系：近年流行\n"
              "【商用車顏色】\n"
              "- 小貨車：白色為主\n"
              "- 大貨車：白色/藍色/綠色\n"
              "- 計程車：黃色（法定）\n"
              "- 公車：各客運公司塗裝不同\n"
              "【AI 辨識建議】\n"
              "- 白/黑/灰佔 70% 以上，需搭配車型辨識\n"
              "- 夜間顏色辨識困難，建議搭配車燈特徵\n"
              "- 反光/金屬漆在不同光線下顏色會變化"},

        {"q": "台灣車輛的尺寸分類標準是什麼？",
         "a": "台灣車輛尺寸分類標準（依公路法/道路交通安全規則）：\n"
              "【小型車】\n"
              "- 小客車：座位 9 人以下，總重 3.5 噸以下\n"
              "  - 轎車：長 4.2-5.0m，寬 1.7-1.9m，高 1.4-1.5m\n"
              "  - SUV：長 4.3-5.0m，寬 1.8-2.0m，高 1.6-1.8m\n"
              "  - 小型 MPV：長 4.0-4.5m\n"
              "【大型車】\n"
              "- 大客車：座位 10 人以上\n"
              "  - 市區公車：長 10-12m，寬 2.5m\n"
              "  - 遊覽車：長 12-13.5m\n"
              "  - 雙節公車：長 18m\n"
              "- 大貨車：總重 3.5 噸以上\n"
              "  - 一般大貨車：長 6-10m\n"
              "  - 全聯結車：長 18-20m\n"
              "  - 半聯結車：長 16.5m\n"
              "【機車】\n"
              "- 普通輕型：50cc 以下\n"
              "- 普通重型：50-250cc\n"
              "- 大型重型（黃牌）：250-550cc\n"
              "- 大型重型（紅牌）：550cc 以上\n"
              "【AI 辨識建議】\n"
              "- 車輛長寬比可區分轎車/SUV/貨車\n"
              "- 車高是區分小客車與大型車的關鍵\n"
              "- 輪軸數量：2 軸（小車）、3 軸（大貨車）、4+ 軸（聯結車）"},
    ])

    return entries


# =====================================================================
# 3. 營建材料、物料、機具
# =====================================================================

def get_construction_materials_knowledge() -> list[dict]:
    """大宗營建材料、物料、機具資料"""
    entries = []

    # ── 混凝土相關 ──
    entries.extend([
        {"q": "台灣營建常用的混凝土種類與規格有哪些？",
         "a": "台灣營建常用混凝土種類與規格：\n"
              "【依強度分類（28天抗壓強度）】\n"
              "1. 140 kgf/cm²（C14）：PC 混凝土、墊層、填充\n"
              "2. 175 kgf/cm²（C17）：一般基礎、擋土牆\n"
              "3. 210 kgf/cm²（C21）：一般結構、樓板、梁柱\n"
              "4. 245 kgf/cm²（C24）：中高層建築結構\n"
              "5. 280 kgf/cm²（C28）：高層建築、橋梁\n"
              "6. 350 kgf/cm²（C35）：預力混凝土、特殊結構\n"
              "7. 420+ kgf/cm²（C42+）：超高層建築、特殊工程\n"
              "【依坍度分類】\n"
              "- 低坍度（5-8cm）：路面、大體積混凝土\n"
              "- 中坍度（10-15cm）：一般結構\n"
              "- 高坍度（18-23cm）：高流動性、SCC 自充填混凝土\n"
              "【特殊混凝土】\n"
              "- SCC 自充填混凝土：免振動\n"
              "- 輕質混凝土：隔熱、減重\n"
              "- 纖維混凝土：鋼纖維/PP 纖維\n"
              "- 早強混凝土：3 天達設計強度\n"
              "- 低熱混凝土：大體積澆置\n"
              "- 防水混凝土：地下室、水池\n"
              "【預拌混凝土價格參考】\n"
              "- C21（210）：約 2,200-2,800 元/m³\n"
              "- C28（280）：約 2,800-3,500 元/m³\n"
              "- C35（350）：約 3,500-4,200 元/m³\n"
              "（價格隨砂石料源、運距、季節波動）"},

        {"q": "台灣營建常用的鋼筋種類與規格有哪些？",
         "a": "台灣營建常用鋼筋種類與規格（CNS 560）：\n"
              "【竹節鋼筋（變形鋼筋）】\n"
              "1. SD280（舊稱 #3~#11）：降伏強度 2,800 kgf/cm²\n"
              "2. SD420（最常用）：降伏強度 4,200 kgf/cm²\n"
              "3. SD490：降伏強度 4,900 kgf/cm²\n"
              "4. SD550：降伏強度 5,500 kgf/cm²（高強度）\n"
              "【鋼筋號數與直徑】\n"
              "- #3（D10）：直徑 9.53mm，單位重 0.560 kg/m\n"
              "- #4（D13）：直徑 12.7mm，單位重 0.994 kg/m\n"
              "- #5（D16）：直徑 15.9mm，單位重 1.56 kg/m\n"
              "- #6（D19）：直徑 19.1mm，單位重 2.25 kg/m\n"
              "- #7（D22）：直徑 22.2mm，單位重 3.04 kg/m\n"
              "- #8（D25）：直徑 25.4mm，單位重 3.98 kg/m\n"
              "- #9（D29）：直徑 28.7mm，單位重 5.08 kg/m\n"
              "- #10（D32）：直徑 32.3mm，單位重 6.39 kg/m\n"
              "- #11（D36）：直徑 35.8mm，單位重 7.90 kg/m\n"
              "【價格參考】\n"
              "- SD420 竹節鋼筋：約 22,000-28,000 元/噸\n"
              "（價格隨國際鋼價、需求波動）\n"
              "【AI 辨識重點】\n"
              "- 鋼筋表面有竹節紋路\n"
              "- 粗細可估算號數\n"
              "- 綁紮方式可判斷結構類型"},
    ])

    # ── 鋼構材料 ──
    entries.extend([
        {"q": "台灣營建常用的鋼構材料有哪些？",
         "a": "台灣營建常用鋼構材料：\n"
              "【型鋼】\n"
              "1. H 型鋼：最常用結構型鋼\n"
              "   - 常用規格：H-200×200、H-300×300、H-400×400\n"
              "   - 材質：SS400、SM490、SM520\n"
              "2. I 型鋼：較舊式，逐漸被 H 型鋼取代\n"
              "3. 槽鋼（C 型鋼）：輕鋼構、次結構\n"
              "4. 角鋼（L 型鋼）：支撐、連接\n"
              "5. 方管/圓管：柱、桁架\n"
              "【鋼板】\n"
              "6. 普通鋼板：SS400，厚 6-100mm\n"
              "7. 高強度鋼板：SM490/SM520\n"
              "8. 耐候鋼板：SMA490（免塗裝）\n"
              "9. 花紋鋼板：樓梯踏板、平台\n"
              "【鋼筋替代品】\n"
              "10. 鋼絞線：預力混凝土用\n"
              "11. 焊接鋼線網：RC 樓板\n"
              "【價格參考】\n"
              "- H 型鋼：約 25,000-32,000 元/噸\n"
              "- 鋼板：約 22,000-30,000 元/噸"},

        {"q": "台灣營建常用的模板材料有哪些？",
         "a": "台灣營建常用模板材料：\n"
              "【傳統模板】\n"
              "1. 合板模板（夾板）：最常用\n"
              "   - 規格：4×8 尺（122×244cm）\n"
              "   - 厚度：12mm、15mm、18mm\n"
              "   - 材質：柳安合板、進口合板\n"
              "   - 價格：約 350-600 元/片\n"
              "2. 角材（木方）：支撐模板\n"
              "   - 規格：1.5×1.5 寸、2×3 寸、2×4 寸\n"
              "3. 鋼管支撐（鋼管鷹架）：\n"
              "   - 直徑：48.6mm（外徑）\n"
              "   - 長度：1.5m、2m、3m\n"
              "【系統模板】\n"
              "4. 鋁合金模板：可重複使用 200+ 次\n"
              "5. 鋼模板：大型結構、隧道\n"
              "6. 塑膠模板：防水、輕量\n"
              "7. 清水模板：建築清水混凝土\n"
              "【特殊模板】\n"
              "8. 滑動模板：筒倉、煙囪\n"
              "9. 隧道模板台車：隧道襯砌\n"
              "10. 飛模（桌模）：樓板快速施工"},
    ])

    # ── 砂石骨材 ──
    entries.extend([
        {"q": "台灣營建常用的砂石骨材種類有哪些？",
         "a": "台灣營建常用砂石骨材：\n"
              "【粗骨材（碎石）】\n"
              "1. 碎石（1 號）：粒徑 25-40mm，路基、大體積混凝土\n"
              "2. 碎石（2 號）：粒徑 15-25mm，一般混凝土\n"
              "3. 碎石（3 號）：粒徑 5-15mm，細部混凝土\n"
              "4. 級配碎石：混合粒徑，路基、回填\n"
              "【細骨材（砂）】\n"
              "5. 河砂：品質最佳，但來源受限\n"
              "6. 海砂：需脫鹽處理（氯離子 < 0.024%）\n"
              "7. 機製砂（碎砂）：碎石場副產品\n"
              "8. 洗選砂：經水洗分級\n"
              "【回填材料】\n"
              "9. 級配料（A/B 料）：道路基層\n"
              "10. 碎石級配：管溝回填\n"
              "11. 土方：一般回填\n"
              "12. CLSM（控制性低強度材料）：管溝回填替代品\n"
              "【價格參考】\n"
              "- 碎石：約 400-700 元/m³\n"
              "- 砂：約 500-900 元/m³\n"
              "- 級配料：約 300-500 元/m³\n"
              "（價格隨料源距離、季節大幅波動）"},
    ])

    # ── 水泥與添加劑 ──
    entries.extend([
        {"q": "台灣營建常用的水泥種類有哪些？",
         "a": "台灣營建常用水泥種類：\n"
              "【波特蘭水泥（Portland Cement）】\n"
              "1. Type I（普通水泥）：最常用，一般結構\n"
              "2. Type II（中度抗硫水泥）：地下結構\n"
              "3. Type III（早強水泥）：搶修工程\n"
              "4. Type V（高抗硫水泥）：海洋工程\n"
              "【混合水泥】\n"
              "5. 卜特蘭飛灰水泥：摻飛灰，低熱\n"
              "6. 高爐水泥：摻爐石粉，耐久性佳\n"
              "7. 卜作嵐水泥：火山灰質\n"
              "【特殊水泥】\n"
              "8. 白水泥：裝飾用\n"
              "9. 快乾水泥：修補用\n"
              "10. 膨脹水泥：防水工程\n"
              "【台灣主要水泥廠】\n"
              "- 台灣水泥（台泥）\n"
              "- 亞洲水泥（亞泥）\n"
              "- 幸福水泥\n"
              "- 環球水泥\n"
              "【價格參考】\n"
              "- 普通水泥：約 3,200-3,800 元/噸\n"
              "- 50kg/包：約 160-200 元"},

        {"q": "台灣營建常用的混凝土添加劑有哪些？",
         "a": "台灣營建常用混凝土添加劑：\n"
              "【化學摻料】\n"
              "1. 減水劑（WRA）：減少用水量 5-12%\n"
              "2. 高性能減水劑（HRWRA/強塑劑）：減水 15-30%\n"
              "3. 緩凝劑：延長初凝時間（夏季/長距離運送）\n"
              "4. 早強劑：加速硬化（冬季/搶修）\n"
              "5. 輸氣劑（AEA）：提高抗凍融性\n"
              "6. 防水劑：降低滲透性\n"
              "7. 收縮補償劑：減少乾縮裂縫\n"
              "【礦物摻料】\n"
              "8. 飛灰（Fly Ash）：火力發電副產品，取代 15-30% 水泥\n"
              "9. 爐石粉（GGBS）：煉鋼副產品，取代 30-70% 水泥\n"
              "10. 矽灰（Silica Fume）：高強度/高耐久混凝土\n"
              "11. 石灰石粉：填充材料\n"
              "【纖維材料】\n"
              "12. 鋼纖維：提高韌性、抗裂\n"
              "13. PP 纖維：防止塑性收縮裂縫\n"
              "14. 玻璃纖維：GRC 預鑄板"},
    ])

    # ── 營建機具 ──
    entries.extend([
        {"q": "台灣營建工地常見的大型機具有哪些？如何辨識？",
         "a": "台灣營建工地常見大型機具與辨識特徵：\n"
              "【挖掘機具】\n"
              "1. 挖土機（怪手/挖掘機）：\n"
              "   - 特徵：履帶式底盤、旋轉上部、長臂+斗\n"
              "   - 規格：0.2m³（小型）~2.0m³（大型）\n"
              "   - 常見品牌：KOMATSU（小松）、CAT（卡特彼勒）、HITACHI（日立）、KOBELCO（神鋼）\n"
              "2. 輪式挖土機：\n"
              "   - 特徵：輪胎式底盤，機動性高\n"
              "3. 迷你挖土機：\n"
              "   - 特徵：寬度 < 1.5m，室內/狹窄空間用\n"
              "【裝載機具】\n"
              "4. 裝載機（山貓/鏟裝機）：\n"
              "   - 特徵：前方大鏟斗，輪胎式\n"
              "   - 常見品牌：CAT、KOMATSU、VOLVO\n"
              "5. 滑移式裝載機（Bobcat）：\n"
              "   - 特徵：小型、原地轉向\n"
              "【起重機具】\n"
              "6. 塔式起重機（塔吊）：\n"
              "   - 特徵：高聳塔身、水平臂、配重\n"
              "   - 規格：吊重 2-25 噸\n"
              "7. 移動式起重機（吊車）：\n"
              "   - 特徵：卡車底盤、伸縮臂\n"
              "   - 規格：25-500 噸\n"
              "   - 常見品牌：TADANO、LIEBHERR、KATO\n"
              "8. 履帶式起重機：\n"
              "   - 特徵：履帶底盤、桁架臂\n"
              "   - 用途：大型吊裝、打樁\n"
              "【壓實機具】\n"
              "9. 壓路機（滾壓機）：\n"
              "   - 特徵：大型鋼輪或膠輪\n"
              "   - 類型：振動壓路機、輪胎壓路機\n"
              "10. 夯實機（蛙式打夯機）：\n"
              "    - 特徵：小型、手持操作\n"
              "【混凝土機具】\n"
              "11. 混凝土泵車（泵浦車）：\n"
              "    - 特徵：卡車底盤 + 折疊式泵送臂\n"
              "    - 臂長：32-63m\n"
              "12. 混凝土預拌車（攪拌車）：\n"
              "    - 特徵：旋轉攪拌桶\n"
              "    - 容量：8-12m³\n"
              "【打樁機具】\n"
              "13. 全套管基樁機：\n"
              "    - 特徵：大型旋轉鑽機\n"
              "14. 反循環基樁機：\n"
              "    - 特徵：鑽桿 + 泥漿循環\n"
              "15. 打擊式打樁機：\n"
              "    - 特徵：落錘/柴油錘"},

        {"q": "台灣營建工地常見的中小型機具與工具有哪些？",
         "a": "台灣營建工地常見中小型機具與工具：\n"
              "【電動工具】\n"
              "1. 電鑽/衝擊鑽：鑽孔、鎖螺絲\n"
              "2. 砂輪機（角磨機）：切割鋼筋、研磨\n"
              "3. 電焊機：鋼筋點焊、鋼構焊接\n"
              "4. 切割機：切割鋼筋、鋼管\n"
              "5. 振動棒（震動器）：混凝土搗實\n"
              "6. 抹光機（磨光機）：地坪收光\n"
              "7. 電動鏈鋸：木材切割\n"
              "【氣動工具】\n"
              "8. 空壓機：提供壓縮空氣\n"
              "9. 氣動釘槍：模板釘合\n"
              "10. 氣動破碎機（風鎬）：拆除混凝土\n"
              "【測量工具】\n"
              "11. 全站儀（經緯儀）：測量定位\n"
              "12. 水準儀：高程測量\n"
              "13. GPS/GNSS 接收器：大地測量\n"
              "14. 3D 雷射掃描儀：點雲測量\n"
              "15. 雷射水平儀：室內放樣\n"
              "16. 捲尺/鋼尺：基本量測\n"
              "【安全設備】\n"
              "17. 安全帽：白色（主管）、黃色（工人）、紅色（訪客）\n"
              "18. 安全帶/背負式安全帶：高空作業\n"
              "19. 反光背心：交通管制\n"
              "20. 安全鞋：鋼頭鞋\n"
              "21. 護目鏡/面罩：焊接、切割\n"
              "22. 耳塞/耳罩：噪音防護"},

        {"q": "台灣營建工地常見的鷹架種類有哪些？",
         "a": "台灣營建工地常見鷹架種類：\n"
              "【門型鷹架（框式鷹架）】\n"
              "- 最常用，組裝快速\n"
              "- 規格：寬 1.2m × 高 1.7m（標準框）\n"
              "- 承載力：約 2,000 kgf/支\n"
              "- 最大搭設高度：45m（需計算）\n"
              "【系統鷹架（盤扣式鷹架）】\n"
              "- 承載力高，安全性佳\n"
              "- 規格：立桿間距 0.6-1.5m\n"
              "- 承載力：約 3,000-5,000 kgf/支\n"
              "- 適用：高層建築、大跨度\n"
              "【單管鷹架（鋼管鷹架）】\n"
              "- 靈活性最高\n"
              "- 鋼管直徑：48.6mm\n"
              "- 以扣件連接\n"
              "【懸吊式鷹架】\n"
              "- 吊籃式：外牆施工\n"
              "- 吊掛式：橋梁底部\n"
              "【移動式鷹架】\n"
              "- 底部有輪子\n"
              "- 室內裝修用\n"
              "- 高度 < 6m\n"
              "【AI 辨識重點】\n"
              "- 門型鷹架：H 型框架明顯\n"
              "- 系統鷹架：圓盤節點明顯\n"
              "- 鷹架上應有安全網、踢腳板\n"
              "- 鷹架顏色通常為銀色（鍍鋅）或紅色（漆）"},

        {"q": "台灣營建常用的防水材料有哪些？",
         "a": "台灣營建常用防水材料：\n"
              "【塗膜防水】\n"
              "1. PU 防水塗料（聚氨酯）：屋頂、露台\n"
              "2. 彈性水泥：浴室、水池\n"
              "3. 環氧樹脂：地下室、水箱\n"
              "4. 矽酸質滲透結晶型：混凝土自癒防水\n"
              "【片材防水】\n"
              "5. 改質瀝青防水毯：地下室外牆\n"
              "6. PVC 防水膜：屋頂、隧道\n"
              "7. TPO 防水膜：綠建築屋頂\n"
              "8. HDPE 防水膜：地下室底板\n"
              "【止水材料】\n"
              "9. 止水帶（PVC/橡膠）：施工縫\n"
              "10. 止水條（膨脹橡膠）：施工縫\n"
              "11. 止水鋼板：施工縫\n"
              "12. 環氧樹脂灌注：裂縫修補\n"
              "【價格參考】\n"
              "- PU 防水：約 300-600 元/m²（含施工）\n"
              "- 防水毯：約 200-400 元/m²\n"
              "- 彈性水泥：約 150-300 元/m²"},

        {"q": "台灣營建常用的管材種類有哪些？",
         "a": "台灣營建常用管材：\n"
              "【給水管】\n"
              "1. 不鏽鋼管（SUS304/316）：飲用水管\n"
              "2. PE 管（聚乙烯）：自來水配水管\n"
              "3. PVC 管（聚氯乙烯）：一般給水\n"
              "4. PPR 管：熱水管\n"
              "【排水管】\n"
              "5. PVC 排水管：建築排水\n"
              "6. HDPE 雙壁波紋管：地下排水\n"
              "7. RC 管（鋼筋混凝土管）：大口徑排水\n"
              "8. 鑄鐵管：高層建築排水\n"
              "【消防管】\n"
              "9. 鍍鋅鋼管：消防管路\n"
              "10. 無縫鋼管：高壓消防\n"
              "【電氣管】\n"
              "11. EMT 管（薄壁金屬管）：電線導管\n"
              "12. PVC 電管：埋入式電線管\n"
              "13. CD 管（波紋管）：弱電配管\n"
              "【常用口徑】\n"
              "- 家用給水：15-25mm\n"
              "- 排水管：50-150mm\n"
              "- 消防管：50-200mm\n"
              "- 下水道：200-2000mm"},

        {"q": "台灣營建常用的磁磚與石材種類有哪些？",
         "a": "台灣營建常用磁磚與石材：\n"
              "【磁磚】\n"
              "1. 拋光石英磚：客廳、大廳（60×60、80×80cm）\n"
              "2. 木紋磚：臥室、客廳（15×90、20×120cm）\n"
              "3. 板岩磚：外牆、地坪\n"
              "4. 馬賽克磁磚：浴室、泳池\n"
              "5. 外牆磚：丁掛磚、二丁掛\n"
              "6. 地鐵磚：廚房、浴室（10×20、10×30cm）\n"
              "7. 大板磚：120×240cm（薄板 3-6mm）\n"
              "【天然石材】\n"
              "8. 花崗石：外牆、地坪、檯面\n"
              "9. 大理石：室內地坪、牆面\n"
              "10. 板岩：外牆、景觀\n"
              "11. 砂岩：景觀、裝飾\n"
              "【人造石材】\n"
              "12. 人造石英石：檯面\n"
              "13. 崗石（人造花崗石）：外牆\n"
              "14. 文化石：裝飾牆面"},
    ])

    return entries


# =====================================================================
# 主程式
# =====================================================================

def main():
    print("=" * 60)
    print("  築未科技 — 台灣交通/車輛/營建 知識抓取與學習")
    print("=" * 60)

    coll = get_collection()
    count_before = coll.count()
    print(f"\n知識庫現有筆數: {count_before}")

    results = {}
    t0 = time.time()

    # 1. 交通設施
    print("\n" + "=" * 40)
    print("📍 1/3 台灣交通道路設施規定")
    print("=" * 40)
    traffic_entries = get_traffic_facility_knowledge()
    print(f"  準備 {len(traffic_entries)} 筆資料")
    results["traffic"] = batch_learn(traffic_entries, source="tw_traffic_facility", prefix="traffic")

    # 2. 車輛辨識
    print("\n" + "=" * 40)
    print("🚗 2/3 台灣車輛辨識資料")
    print("=" * 40)
    vehicle_entries = get_vehicle_recognition_knowledge()
    print(f"  準備 {len(vehicle_entries)} 筆資料")
    results["vehicle"] = batch_learn(vehicle_entries, source="tw_vehicle_recognition", prefix="vehicle")

    # 3. 營建材料
    print("\n" + "=" * 40)
    print("🏗️ 3/3 營建材料、物料、機具")
    print("=" * 40)
    construction_entries = get_construction_materials_knowledge()
    print(f"  準備 {len(construction_entries)} 筆資料")
    results["construction"] = batch_learn(construction_entries, source="tw_construction_materials", prefix="constr")

    # 統計
    elapsed = time.time() - t0
    count_after = get_collection().count()
    total_written = sum(r["written"] for r in results.values())
    total_skipped = sum(r["skipped"] for r in results.values())
    total_errors = sum(r["errors"] for r in results.values())

    print("\n" + "=" * 60)
    print("  學習完成總結")
    print("=" * 60)
    print(f"  知識庫: {count_before} → {count_after} (+{count_after - count_before})")
    print(f"  寫入: {total_written} 筆")
    print(f"  跳過（已存在）: {total_skipped} 筆")
    print(f"  錯誤: {total_errors} 筆")
    print(f"  耗時: {elapsed:.1f} 秒")
    print()
    for cat, r in results.items():
        print(f"  [{cat}] written={r['written']} skipped={r['skipped']} errors={r['errors']}")
    print("=" * 60)

    # 記錄日誌
    log_event("batch_scrape_tw_knowledge", {
        "count_before": count_before,
        "count_after": count_after,
        "results": results,
        "elapsed_sec": round(elapsed, 1),
    })

    return results


if __name__ == "__main__":
    main()
