<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†å¾Œå° - ç¯‰æœªç§‘æŠ€</title>
    <link rel="stylesheet" href="/static/css/admin.css">
</head>
<body class="admin-dashboard">
    <!-- å´é‚Šæ¬„ -->
    <nav class="sidebar">
        <div class="sidebar-header">
            <h2>ğŸ¢ ç¯‰æœªç§‘æŠ€</h2>
            <p>ç®¡ç†å¾Œå°</p>
        </div>
        
        <ul class="sidebar-menu">
            <li class="menu-item active">
                <a href="/admin/dashboard">ğŸ“Š å„€è¡¨æ¿</a>
            </li>
            <li class="menu-item">
                <a href="/admin/contacts">ğŸ“ è¯ç¹«è¡¨å–®</a>
            </li>
            <li class="menu-item">
                <a href="/admin/analytics">ğŸ“ˆ ç¶²ç«™åˆ†æ</a>
            </li>
            <li class="menu-item">
                <a href="/admin/users">ğŸ‘¥ ç”¨æˆ¶ç®¡ç†</a>
            </li>
            <li class="menu-item">
                <a href="/admin/settings">âš™ï¸ ç³»çµ±è¨­ç½®</a>
            </li>
        </ul>
        
        <div class="sidebar-footer">
            <p>æ­¡è¿, {{ current_user.username }}</p>
            <form method="post" action="/admin/logout" style="margin-top: 10px;">
                <button type="submit" class="btn btn-outline btn-small">ç™»å‡º</button>
            </form>
        </div>
    </nav>
    
    <!-- ä¸»å…§å®¹å€ -->
    <main class="main-content">
        <header class="content-header">
            <h1>å„€è¡¨æ¿</h1>
            <div class="header-actions">
                <span class="current-time" id="currentTime"></span>
            </div>
        </header>
        
        <!-- çµ±è¨ˆå¡ç‰‡ -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">ğŸ‘¥</div>
                <div class="stat-content">
                    <h3>{{ user_count }}</h3>
                    <p>ç¸½ç”¨æˆ¶æ•¸</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">ğŸ“Š</div>
                <div class="stat-content">
                    <h3 id="totalVisits">0</h3>
                    <p>ç¸½è¨ªå•é‡</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">ğŸ“</div>
                <div class="stat-content">
                    <h3 id="totalSubmissions">0</h3>
                    <p>è¯ç¹«æäº¤</p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">ğŸ¤–</div>
                <div class="stat-content">
                    <h3 id="todayVisits">0</h3>
                    <p>ä»Šæ—¥è¨ªå•</p>
                </div>
            </div>
        </div>
        
        <!-- æœ€è¿‘è¯ç¹«è¡¨å–® -->
        <section class="section">
            <h2>æœ€è¿‘è¯ç¹«è¡¨å–®</h2>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>å§“å</th>
                            <th>éƒµç®±</th>
                            <th>é›»è©±</th>
                            <th>æäº¤æ™‚é–“</th>
                            <th>ç‹€æ…‹</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for submission in submissions %}
                        <tr>
                            <td>{{ submission[1] }}</td>
                            <td>{{ submission[2] }}</td>
                            <td>{{ submission[3] or 'æœªæä¾›' }}</td>
                            <td>{{ submission[5][:16] }}</td>
                            <td>
                                <span class="status-badge status-{{ submission[6] }}">
                                    {{ submission[6] }}
                                </span>
                            </td>
                            <td>
                                <button class="btn btn-small" onclick="viewSubmission({{ submission[0] }})">æŸ¥çœ‹</button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>
        
        <!-- ç¶²ç«™çµ±è¨ˆåœ–è¡¨ -->
        <section class="section">
            <h2>æœ€è¿‘7å¤©è¨ªå•çµ±è¨ˆ</h2>
            <div class="chart-container">
                <canvas id="visitsChart" width="400" height="200"></canvas>
            </div>
        </section>
        
        <!-- å¿«é€Ÿæ“ä½œ -->
        <section class="section">
            <h2>å¿«é€Ÿæ“ä½œ</h2>
            <div class="quick-actions">
                <a href="/admin/contacts" class="action-card">
                    <div class="action-icon">ğŸ“</div>
                    <h3>ç®¡ç†è¯ç¹«è¡¨å–®</h3>
                    <p>æŸ¥çœ‹å’Œè™•ç†ç”¨æˆ¶æäº¤çš„è¡¨å–®</p>
                </a>
                
                <a href="/admin/analytics" class="action-card">
                    <div class="action-icon">ğŸ“ˆ</div>
                    <h3>ç¶²ç«™åˆ†æ</h3>
                    <p>æŸ¥çœ‹è©³ç´°çš„è¨ªå•çµ±è¨ˆæ•¸æ“š</p>
                </a>
                
                <a href="/admin/settings" class="action-card">
                    <div class="action-icon">âš™ï¸</div>
                    <h3>ç³»çµ±è¨­ç½®</h3>
                    <p>é…ç½®ç¶²ç«™å’Œç³»çµ±åƒæ•¸</p>
                </a>
            </div>
        </section>
    </main>
    
    <!-- æ¨¡æ…‹æ¡† -->
    <div id="submissionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>è¯ç¹«è¡¨å–®è©³æƒ…</h3>
                <button class="close-modal" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- å…§å®¹å°‡ç”±JavaScriptå‹•æ…‹å¡«å…… -->
            </div>
        </div>
    </div>
    
    <script src="/static/js/admin.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // å¯¦æ™‚æ›´æ–°æ™‚é–“
        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = 
                now.toLocaleString('zh-TW');
        }
        
        setInterval(updateTime, 1000);
        updateTime();
        
        // åŠ è¼‰çµ±è¨ˆæ•¸æ“š
        async function loadStats() {
            try {
                const response = await fetch('/api/stats');
                const data = await response.json();
                
                document.getElementById('totalVisits').textContent = data.total_visits;
                document.getElementById('totalSubmissions').textContent = data.total_submissions;
                document.getElementById('todayVisits').textContent = data.today.visits;
                
                // æ›´æ–°åœ–è¡¨
                updateChart(data);
                
            } catch (error) {
                console.error('åŠ è¼‰çµ±è¨ˆæ•¸æ“šå¤±æ•—:', error);
            }
        }
        
        // æ›´æ–°åœ–è¡¨
        function updateChart(data) {
            const ctx = document.getElementById('visitsChart').getContext('2d');
            
            // é€™è£¡æ‡‰è©²å¾æœå‹™å™¨ç²å–çœŸå¯¦çš„7å¤©æ•¸æ“š
            // æš«æ™‚ä½¿ç”¨ç¤ºä¾‹æ•¸æ“š
            const chartData = {
                labels: ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5', 'Day 6', 'Today'],
                datasets: [{
                    label: 'è¨ªå•é‡',
                    data: [120, 150, 180, 90, 200, 160, data.today.visits],
                    borderColor: '#3b82f6',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    tension: 0.4
                }]
            };
            
            new Chart(ctx, {
                type: 'line',
                data: chartData,
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
        
        // æŸ¥çœ‹è¡¨å–®è©³æƒ…
        function viewSubmission(id) {
            // é€™è£¡æ‡‰è©²å¾æœå‹™å™¨ç²å–è©³ç´°ä¿¡æ¯
            // æš«æ™‚é¡¯ç¤ºç¤ºä¾‹å…§å®¹
            document.getElementById('modalBody').innerHTML = `
                <p><strong>è¡¨å–®ID:</strong> ${id}</p>
                <p><strong>è©³ç´°ä¿¡æ¯åŠ è¼‰ä¸­...</strong></p>
                <p>å¯¦éš›é–‹ç™¼ä¸­æ‡‰è©²å¾æœå‹™å™¨ç²å–å®Œæ•´çš„è¡¨å–®æ•¸æ“šã€‚</p>
            `;
            document.getElementById('submissionModal').style.display = 'block';
        }
        
        // é—œé–‰æ¨¡æ…‹æ¡†
        function closeModal() {
            document.getElementById('submissionModal').style.display = 'none';
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadStats();
            
            // é»æ“Šæ¨¡æ…‹æ¡†å¤–éƒ¨é—œé–‰
            window.onclick = function(event) {
                const modal = document.getElementById('submissionModal');
                if (event.target === modal) {
                    closeModal();
                }
            }
        });
    </script>
</body>
</html>