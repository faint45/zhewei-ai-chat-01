# 築未科技 — 接續部屬移交報告

**用途**：可直接移交其他 AI 或開發者接續處理；確保遵循架構鎖定規則。  
**專案路徑**：`c:\Users\user\Desktop\zhe-wei-tech`（Windows）。

---

## 一、當前系統狀態

| 項目 | 狀態 | 備註 |
|------|------|------|
| **核心代碼** | 就緒（brain_server.py, agent_logic.py, ai_service.py 等） | 架構鎖定，禁止修改指定區域。 |
| **D 槽部署** | 已完成（D:\brain_workspace 目錄結構就緒） | 通過 deploy_to_d_drive.ps1 執行。 |
| **環境變數** | .env 配置完成（含 BRAIN_WORKSPACE, ZHEWEI_MEMORY_ROOT） | 需確認 CLOUDFLARE_TOKEN 是否填寫。 |
| **本地服務** | 可啟動（python brain_server.py 或 啟動完整跑.bat） | 管理介面：/admin；手機對話頁：/chat |
| **外網訪問** | 未啟用（需 docker compose up -d 且 .env 有 CLOUDFLARE_TOKEN） | 網址：https://brain.zhe-wei.net |
| **Railway 生產** | 已部署 | https://zhewei-ai-chat-01-production.up.railway.app；內網：zhewei-ai-chat-01.railway.internal |

---

## 二、已接續完成事項

### 步驟 1–3

- Python 依賴安裝（requirements-brain.txt）。
- D 槽部署與環境變數配置。
- 本地服務啟動與基礎測試通過（test_brain_server.py）。

### 步驟 4 接線

- **update_web_admin**：已接線。agent_tools 寫入 BRAIN_WORKSPACE/output/web_admin_progress.json；brain_server 每 2 秒讀取並經 WebSocket 廣播。
- **deploy_service**：已接線。白名單 nssm 服務名（ZheweiBrain/Ollama/Rclone）或 D/Z 下 .bat/.cmd/.ps1 路徑。
- **generate_media**：媒體生成路徑確認（D:\brain_workspace\output）；API 對接待補。
- **brain_server**：啟動時載入 `.env`；/health 擴充；/static/index.html、/admin、/chat（手機對話頁）；PORT 支援 Railway。
- **完整跑啟動**：scripts/run_full_system.py、啟動完整跑.bat（預檢＋完整跑條件＋啟動 brain_server）；網頁與手機版對話頁（index.html 響應式、chat.html 手機版）。

---

## 三、待辦缺口清單

| 缺口類別 | 具體任務 | 優先級 | 狀態 |
|----------|----------|--------|------|
| **Claude 集成** | 在 .env 補 ANTHROPIC_API_KEY 或 CLAUDE_API_KEY；ai_service.ClaudeService、run_workflow_step 已接線。 | 高 | 已接線，補 key 即啟用 |
| **外網部署** | 啟動 Docker Desktop 後執行 docker compose up -d；.env 需 CLOUDFLARE_TOKEN。 | 中 | 需本機啟動 Docker |
| **MCP 對接** | .cursor/mcp.json 已設 Windows-MCP（python -m uv tool run）；uv 已 pip 安裝。 | 可選 | 已配置 |
| **E2E 測試** | scripts/run_e2e.py 已建立並可執行單次任務與視覺與報表。 | 高 | 已建立 |

---

## 四、移交注意事項

### 禁止修改

- agent_tools.py 第 213–234 行（run_vision_engine）。
- report_generator.py 的分流路徑與產出格式。

### 路徑限制

- 所有產出限 D:\brain_workspace 或 Z:\Zhewei_Brain。
- 進度數值使用 LaTeX 格式（如 $100\%$）。

### 代碼規範

- 更新時需提供完整檔案，禁止片段提交。

---

## 五、移交文件清單

### 核心文檔

- 本地AI系統缺口清單.md
- 交接清單_2026-02-08.md
- 架構守則.md

### 部署腳本

- scripts/deploy_to_d_drive.ps1、scripts/deploy_to_d_drive.py
- scripts/run_full_system.py、啟動完整跑.bat
- 一鍵部屬到D槽.bat
- Procfile、requirements.txt、runtime.txt（Railway 部屬用）

### 測試工具

- startup_diagnostics.py
- test_brain_server.py

---

## 六、建議下一步

1. **管理介面／對話頁**：/admin（桌面＋手機響應）、/chat（手機版）；若 404 請確認端口 8000 僅一 brain_server 並重啟。完整跑：雙擊 啟動完整跑.bat 或 `python scripts/run_full_system.py`。
2. **Claude / 外網**：在 .env 補 ANTHROPIC_API_KEY、CLOUDFLARE_TOKEN；外網需先啟動 Docker Desktop 再執行 docker compose up -d。
3. **E2E**：Ollama 啟動或 input 有圖片後可跑 `python scripts/run_e2e.py`。
4. **部屬到 Railway**：專案已含 Procfile、requirements.txt（-r requirements-brain.txt）、runtime.txt；brain_server 已讀取 PORT（Railway 注入）。推送到 GitHub 後在 Railway 從 Repo 部署，於 Variables 設定 GEMINI_API_KEY、ANTHROPIC_API_KEY 等。

---

*此報告可直接移交其他 AI 或開發者接續處理，確保遵循架構鎖定規則。*
