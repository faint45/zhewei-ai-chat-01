# Implementation Plan - AI Coding Workflow Standard

## 1. 計畫先行 (Reasoning & Planning)

### 1.1 需求接收後的標準流程
```
需求輸入 → 分析評估 → 輸出 Implementation_Plan.md → 確認 → 執行
```

### 1.2 Implementation_Plan.md 必要內容
| 區塊 | 說明 |
|------|------|
| **需求摘要** | 用戶需求的簡潔描述 |
| **架構分析** | 現有系統架構、相關模組、依賴關係 |
| **資料庫結構** | 涉及的表格、欄位、關聯 |
| **API 邏輯** | 相關端點、參數、回傳格式 |
| **約束條件** | 專業領域限制（如營建法規、誤差容許值） |
| **實作步驟** | 分階段實作計畫 |
| **驗證方式** | 測試策略、確認項目 |

### 1.3 禁止事項
- ❌ 未輸出 Implementation_Plan.md 直接編碼
- ❌ 未確認需求直接假設
- ❌ 要求使用者手動複製貼上程式碼

---

## 2. 全域感知 (Context Awareness)

### 2.1 主動讀取範圍
```
□ 專案根目錄結構
□ 相關模組的 __init__.py / exports
□ 資料庫 schema.sql
□ brain_server.py API 端點
□ ai_service.py 服務介面
□ discord_bot.py（如果有）
□ 現有的 workflow 文件
```

### 2.2 分析重點
- 程式碼風格一致性
- 命名慣例
- 錯誤處理模式
- 日誌記錄方式

---

## 3. 環境掌控 (Execution & Self-Healing)

### 3.1 編碼前確認清單
- [ ] 資料庫結構已讀取
- [ ] 相關 API 端點已確認
- [ ] 專業約束已釐清（如：RS10 點雲誤差容許值）
- [ ] 現有程式碼風格已同步
- [ ] 使用者確認實作計畫

### 3.2 代碼品質標準
- 資料庫操作：使用現有的 db_postgres.py 或 database.py
- API 端點：遵循 brain_server.py 的模式
- 錯誤處理：一致的例外處理方式
- 日誌記錄：使用現有的 logger 機制

### 3.3 自癒機制
- 編碼過程中發現衝突 → 回報並請求確認
- 發現未預期的依賴 → 主動搜尋並納入計畫
- 測試失敗 → 分析原因並修正計畫

---

## 4. 專案特定約束

### 4.1 營建管理系統 (construction_mgmt/)
- 法規遵循：施工規範、交通工程手冊
- 表格結構：符合 database.py 定義
- 單位轉換：公制單位為主

### 4.2 AI 服務 (ai_service.py)
- 模型路由：遵循 smart_route 模式
- Provider 介面：符合 AIProvider 標準
- Timeout 設定：依服務類型調整

### 4.3 Discord Bot
- 指令格式：符合現有 slash command 規範
- 權限檢查：使用現有的 permission 機制

---

## 5. 工作流程狀態

| 階段 | 狀態 | 說明 |
|------|------|------|
| 1. 需求分析 | 待執行 | 接收並理解需求 |
| 2. 架構規劃 | 待執行 | 輸出 Implementation_Plan.md |
| 3. 確認審核 | 待執行 | 等待使用者確認 |
| 4. 實作執行 | 待執行 | 開始編碼 |
| 5. 驗證測試 | 待執行 | 確認功能正常 |

---

## 6. 適用範圍

本規範適用於：
- ✅ 新功能開發
- ✅ 系統整合
- ✅ 資料庫修改
- ✅ API 擴充
- ✅ 既有功能優化

---

## 7. 範例：需求確認格式

```
【需求摘要】
[簡潔描述使用者需求]

【相關檔案】
- [檔案1]
- [檔案2]

【待確認事項】
1. [問題1]
2. [問題2]

【預計產出】
- [檔案1]
- [檔案2]
```

---

*建立日期：2026-02-18*
*版本：1.0*
